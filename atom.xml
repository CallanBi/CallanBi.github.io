<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://CallanBi.github.io</id>
    <title>Callan Bi&apos;s Blog</title>
    <updated>2022-09-04T07:10:43.063Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://CallanBi.github.io"/>
    <link rel="self" href="https://CallanBi.github.io/atom.xml"/>
    <subtitle>Callan Bi çš„åšå®¢ï¼Œè®°å½•æŠ€æœ¯æˆé•¿å’Œæ—¥å¸¸</subtitle>
    <logo>https://CallanBi.github.io/images/avatar.png</logo>
    <icon>https://CallanBi.github.io/favicon.ico</icon>
    <rights>All rights reserved 2022, Callan Bi&apos;s Blog</rights>
    <entry>
        <title type="html"><![CDATA[JavaScript is weird! è®°ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„è¡¨è¾¾å¼æ‰“ç‰¢åŸºç¡€]]></title>
        <id>https://CallanBi.github.io/post/javascript-is-weird-ji-yi-xie-qi-qi-guai-guai-de-biao-da-shi-da-lao-ji-chu/</id>
        <link href="https://CallanBi.github.io/post/javascript-is-weird-ji-yi-xie-qi-qi-guai-guai-de-biao-da-shi-da-lao-ji-chu/">
        </link>
        <updated>2022-04-21T15:15:49.000Z</updated>
        <content type="html"><![CDATA[<p>é¦–å…ˆåœ¨ <a href="https://jsisweird.com/">https://jsisweird.com/</a> è¿™ä¸ªç½‘ç«™çœ‹çœ‹ç©¶ç«Ÿèƒ½å¯¹å¤šå°‘é¢˜ã€‚</p>
<p>è®°å½•ä¸€ä¸‹æˆ‘æ‰€ä¸æ¸…æ¥šçš„åœ°æ–¹ã€‚</p>
<h1 id="æ•°å­—-æ— ç©·ä¸0ç›¸äº’è¿ç®—ä¼šå‘ç”Ÿä»€ä¹ˆ">æ•°å­—ã€æ— ç©·ä¸0ç›¸äº’è¿ç®—ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</h1>
<pre><code class="language-javascript">2 / 0 // Infinity
0 / 0 // NaN
-1 / 0 //-Infinity
Infinity * 0 // NaN
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://CallanBi.github.io/post-images/1650600972687.png" alt="" loading="lazy"></figure>
<h1 id="åŸå§‹ç±»å‹åŸºæœ¬ç±»å‹">åŸå§‹ç±»å‹ï¼ˆåŸºæœ¬ç±»å‹ï¼‰</h1>
<p>åŸºæœ¬ç±»å‹ï¼ˆåŸºæœ¬æ•°å€¼ã€åŸºæœ¬æ•°æ®ç±»å‹ï¼‰æ˜¯ä¸€ç§æ—¢éå¯¹è±¡ä¹Ÿæ— æ–¹æ³•çš„æ•°æ®ã€‚åœ¨ JavaScript ä¸­ï¼Œå…±æœ‰7ç§åŸºæœ¬ç±»å‹ï¼šstringï¼Œnumberï¼Œbigintï¼Œbooleanï¼Œ<strong>null</strong>ï¼Œundefinedï¼Œsymbol (ECMAScript 2016æ–°å¢)ã€‚</p>
<p>æ³¨æ„ï¼š<br>
è™½ç„¶ <code>typeof null === 'object'</code> ï¼Œä½† <code>null</code> ä¹Ÿæ˜¯åŸå§‹ç±»å‹ã€‚<br>
<code>typeof NaN === 'number'</code>ï¼ŒNaN æ˜¯åŸå§‹ç±»å‹ã€‚</p>
<blockquote>
<p>The <a href="https://262.ecma-international.org/5.1/#sec-4.3.23">ECMAScript Language Specification</a> explains NaN as a number value that is a IEEE 754 â€œNot-a-Numberâ€ value. It might seem strange, but this is a common computer science principle.</p>
<p>There are some odd issues surrounding NaN in JavaScript, however. For instance, this is one of the very few instances where the Object.is function disagrees with triple equal.</p>
<p><code>NaN === NaN; // -&gt; false </code><br>
<code>Object.is(NaN, NaN); // -&gt; true</code></p>
<p>Another such rare instance can be seen in question 24.</p>
<p>This legacy issue was later remedied with the isNaN function.</p>
<p><code>isNaN(NaN); // -&gt; true</code></p>
</blockquote>
<h1 id="åŠ å‡è¿ç®—ç¬¦å‘ç”Ÿçš„å¼ºåˆ¶ç±»å‹è½¬æ¢åˆ°åº•æ˜¯è¿”å›ä»€ä¹ˆ">åŠ å‡è¿ç®—ç¬¦å‘ç”Ÿçš„å¼ºåˆ¶ç±»å‹è½¬æ¢åˆ°åº•æ˜¯è¿”å›ä»€ä¹ˆï¼Ÿ</h1>
<p>æ˜¯è¿”å›å¯¹ä¸¤è¾¹çš„ <code>toString()</code> ? åˆæˆ–è€…æ˜¯ <code>Number()</code> ?</p>
<p>çœ‹ä¸‹ <a href="https://262.ecma-international.org/5.1/#sec-11.6">ECMAScript Language Specification</a> è¿™æ®µè¯ï¼š<br>
<img src="https://CallanBi.github.io/post-images/1650617354502.png" alt="" loading="lazy"></p>
<p>æ€»ç»“ä¸€ä¸‹ã€‚</p>
<h2 id="å¯¹äº-è¿ç®—ç¬¦">å¯¹äº<code>+</code> è¿ç®—ç¬¦</h2>
<ol>
<li>å½“ä¸€è¾¹ä¸º stringï¼Œè¢«è¯†åˆ«ä¸ºå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¼šä¼˜å…ˆå°†å¦ä¸€è¾¹è½¬æ¢ä¸º string ç±»å‹è¿›è¡Œæ‹¼æ¥ã€‚</li>
<li>å½“ä¸€è¾¹ä¸º<strong>å¼•ç”¨ç±»å‹</strong>ï¼Œåˆ™ä¸¤è¾¹éƒ½è½¬åŒ–æˆå­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥ã€‚</li>
<li>å½“ä¸€è¾¹ä¸º numberï¼Œå¦ä¸€è¾¹ä¸º<strong>åŸå§‹ç±»å‹</strong>ï¼Œåˆ™å¦ä¸€è¾¹è½¬æ¢ä¸º number ã€‚</li>
<li>ä¸¤è¾¹éƒ½ä¸ºé number ä¸” é string çš„åŸå§‹ç±»å‹ï¼Œå…ˆå°è¯•å°†ä¸€è¾¹å¼ºåˆ¶è½¬åŒ–ä¸º number ã€‚</li>
</ol>
<pre><code class="language-javascript">123 + '123' // 123123   ï¼ˆè§„åˆ™1ï¼‰
123 + null  // 123    ï¼ˆè§„åˆ™3ï¼‰
123 + true // 124    ï¼ˆè§„åˆ™3ï¼‰
123 + {}  // 123[object Object]    ï¼ˆè§„åˆ™2ï¼‰
</code></pre>
<h2 id="å¯¹äº-è¿ç®—ç¬¦-2">å¯¹äº <code>- ï¼Œ* ï¼Œ/</code> è¿ç®—ç¬¦</h2>
<p>åœ¨å¯¹å„ç§é number ç±»å‹è¿ç”¨æ•°å­¦è¿ç®—ç¬¦(- * /)æ—¶ï¼Œä¼šå…ˆå°†é number ç±»å‹è½¬æ¢ä¸º numberã€‚</p>
<pre><code class="language-javascript">1 - true // 0ï¼Œ é¦–å…ˆæŠŠ true è½¬æ¢ä¸ºæ•°å­— 1ï¼Œ ç„¶åæ‰§è¡Œ 1 - 1
1 - null // 1,  é¦–å…ˆæŠŠ null è½¬æ¢ä¸ºæ•°å­— 0ï¼Œ ç„¶åæ‰§è¡Œ 1 - 0
1 * undefined //  NaN, undefined è½¬æ¢ä¸ºæ•°å­—æ˜¯ NaN
2 * ['5'] //  10ï¼Œ ['5']é¦–å…ˆä¼šå˜æˆ '5' -- æ‹†ç®±æ“ä½œ, ç„¶åå†å˜æˆæ•°å­— 5
</code></pre>
<h1 id="truthy-å€¼">truthy å€¼</h1>
<p>çœ‹ä¸‹<a href="https://developer.mozilla.org/en-US/docs/Glossary/Truthy">è¿™ä¸ª</a>ï¼š</p>
<blockquote>
<p>In JavaScript, a truthy value is a value that is considered true when encountered in a Boolean context. All values are truthy unless they are defined as falsy. That is, all values are truthy except <code>false</code>, <code>0</code>, <code>-0</code>, <code>0n</code>, <code>&quot;&quot;</code>, <code>null</code>, <code>undefined</code>, and <code>NaN</code>.</p>
</blockquote>
<p>ä¸‹é¢è¿™äº›éƒ½æ˜¯ truthy å€¼ï¼š</p>
<pre><code class="language-javascript">if (true)
if ({})
if ([])
if (42)
if (&quot;0&quot;)
if (&quot;false&quot;)
if (new Date())
if (-42)
if (12n)
if (3.14)
if (-3.14)
if (Infinity)
if (-Infinity)
</code></pre>
<p>å¦‚æœæ“ä½œç¬¦å·¦è¾¹çš„è¿ç®—å¯¹è±¡æ˜¯ truthy å€¼ï¼Œåˆ™ <code>&amp;&amp;</code> æ“ä½œç¬¦è¿”å›æ“ä½œç¬¦å³è¾¹çš„è¿ç®—å¯¹è±¡ï¼š</p>
<pre><code class="language-javascript">true &amp;&amp; &quot;dog&quot;
// returns &quot;dog&quot;

[] &amp;&amp; &quot;dog&quot;
// returns &quot;dog&quot;
</code></pre>
<h1 id="æ“ä½œç¬¦çš„è§„åˆ™"><code>==</code> æ“ä½œç¬¦çš„è§„åˆ™</h1>
<p>çœ‹ä¸‹ <a href="https://262.ecma-international.org/11.0/#sec-abstract-equality-comparison">ecma262 ç¬¬11ç‰ˆä¸­å…³äºæŠ½è±¡ç­‰å¼æ¯”è¾ƒï¼ˆAbstract Equality Comparisonï¼‰çš„ä»‹ç»</a>ã€‚</p>
<p>æˆ‘å†™äº†ä¸‹äº†æ¯ä¸€æ¡è§„åˆ™å¯¹åº”çš„åœºæ™¯ï¼š</p>
<pre><code class="language-javascript">/* ç±»å‹ç›¸åŒï¼Œçš„æ‰§è¡Œå…¨ç­‰è¿ç®—åˆ¤æ–­ **/
1 == 2 // false
1 == 1 // true

/* æœ‰ä¸€è¾¹æ˜¯ undefined ä¸”å¦ä¸€è¾¹æ˜¯ nullï¼Œ è¿”å› true **/
undefined == null // true
null == undefined // true

/* ä¸€è¾¹æ˜¯string ä¸€è¾¹æ˜¯ numberï¼Œå…ˆå°† string è½¬ä¸º number **/
1 == '1' // true
1 == '1a' // false, '1a' è°ƒç”¨ Number() ä¼šè½¬åŒ–ä¸º NaN

/* ä¸€è¾¹æ˜¯string ä¸€è¾¹æ˜¯ bigintï¼Œå…ˆå°† string è½¬ä¸º bigint **/
1n == '1' // true
1n == '1a' // false, '1a' è°ƒç”¨ Number() ä¼šè½¬åŒ–ä¸º NaN

/* åªè¦ä¸€è¾¹æ˜¯booleanï¼Œå…ˆå°† boolean å¼ºåˆ¶è½¬ä¸º number **/
1 == true // true
false == 1 // 

/* ä¸€è¾¹æ˜¯ string, number, symbol æˆ– bigintï¼Œå¦ä¸€è¾¹æ˜¯ Object å¼•ç”¨ç±»å‹ï¼Œå…ˆå°† Object è½¬ä¸ºåŸå§‹å€¼ **/
'1,2,[object Object]' == ['1', 2, {}] // true

/* ä¸€è¾¹æ˜¯  bigint, å¦ä¸€è¾¹æ˜¯ number **/
/* å¦‚æœæœ‰ä¸€è¾¹æ˜¯ NaNï¼Œ+Infinity, -Infinityï¼Œè¿”å› falseï¼Œå¦åˆ™æ¯”è¾ƒæ•°å­¦ä¸Šçš„å€¼çš„å¤§å° **/
+Infinity == 999999999999999999999999999n // false
1 == 1n // true
</code></pre>
<p>å‘ç°ï¼š</p>
<ol>
<li>number é™¤äº†å’Œå¼•ç”¨ç±»å‹æ¯”è¾ƒå¤–ï¼Œå’Œå…¶ä»–ç±»å‹æ¯”è¾ƒæ—¶éƒ½æ˜¯å…¶ä»–ç±»å‹å…ˆè½¬ä¸º numberã€‚</li>
<li><code>NaN</code> å’Œå…¶ä»–ä»»ä½•ç±»å‹æ¯”è¾ƒæ°¸è¿œè¿”å› <code>false</code>ï¼ˆåŒ…æ‹¬å’Œå®ƒè‡ªå·±ï¼‰ã€‚</li>
<li>é™¤äº† <code> undefined == null</code> å¤–ï¼Œè¿™ä¸¤ä¸ªå€¼å’Œå…¶ä»–ä»»ä½•ç±»å‹æ¯”è¾ƒéƒ½ä¸º <code>false</code>ã€‚</li>
<li>åªè¦ä¸€è¾¹æ˜¯booleanï¼Œå…ˆå°† boolean å¼ºåˆ¶è½¬ä¸º number</li>
<li>é <code> boolean</code> å¤–çš„åŸå§‹ç±»å‹å’Œå¼•ç”¨ç±»å‹æ¯”è¾ƒï¼Œå…ˆæŠŠå¼•ç”¨ç±»å‹è½¬ä¸ºåŸå§‹ç±»å‹ã€‚</li>
</ol>
<h1 id="äºŒè¿›åˆ¶å…«è¿›åˆ¶åè¿›åˆ¶åå…­è¿›åˆ¶å’Œå®ƒä»¬çš„ç›¸äº’è¿ç®—">äºŒè¿›åˆ¶ï¼Œå…«è¿›åˆ¶ï¼Œåè¿›åˆ¶ï¼Œåå…­è¿›åˆ¶å’Œå®ƒä»¬çš„ç›¸äº’è¿ç®—</h1>
<p>å‚è€ƒï¼š<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Numbers_and_dates">MDN Web Docs Numbers and dates</a>ã€‚</p>
<h2 id="äºŒè¿›åˆ¶binary">äºŒè¿›åˆ¶ï¼ˆbinaryï¼‰</h2>
<p>ä»¥ <code>0b</code> æˆ– <code>0B</code> å¼€å¤´ï¼Œå¦‚ï¼š</p>
<pre><code class="language-javscript">0b01111111100000000000000000000000; // 2139095040
</code></pre>
<h2 id="å…«è¿›åˆ¶octal">å…«è¿›åˆ¶ï¼ˆoctalï¼‰</h2>
<ol>
<li>å¦‚æœå‰å¯¼0åé¢çš„æ•°å­—åœ¨ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>0</mn><mo>âˆ¼</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">0 \sim 7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">âˆ¼</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">7</span></span></span></span> èŒƒå›´å†…ï¼Œåˆ™è¢«è§£è¯»ä¸ºå…«è¿›åˆ¶ï¼›</li>
</ol>
<pre><code class="language-javascript">const n = 0755; // 493
0888 // 888 parsed as decimal
const a = 0o10; // ES2015: 8
const b = 00777; // 510ï¼Œå³ 8^0 7 + 8^1 * 7 + 8^2 * 7
</code></pre>
<ol start="2">
<li>ä»¥ <code>0o</code>å¼€å¤´ã€‚</li>
</ol>
<h2 id="åå…­è¿›åˆ¶hexadecimal">åå…­è¿›åˆ¶ï¼ˆHexadecimalï¼‰</h2>
<p>ä»¥ <code>0x</code> æˆ– <code>0X</code> å¼€å¤´ã€‚</p>
<h2 id="ä»¥-10-ä¸ºåº•çš„æŒ‡æ•°">ä»¥ 10 ä¸ºåº•çš„æŒ‡æ•°</h2>
<p><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>e<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> æˆ– <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span></span></span></span>E<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>m</mi></mrow><annotation encoding="application/x-tex">m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span> è¡¨ç¤º <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>Ã—</mo><mn>1</mn><msup><mn>0</mn><mi>m</mi></msup></mrow><annotation encoding="application/x-tex">n \times 10^m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span></span></span></span></span></span></span></span>ã€‚</p>
<pre><code class="language-javascript">1E3   // 1000
2e6   // 2000000
0.1e2 // 10
</code></pre>
<h2 id="ç›¸äº’è¿ç®—">ç›¸äº’è¿ç®—</h2>
<p>éƒ½å…ˆè½¬ä¸ºåè¿›åˆ¶å†è¿ç®—ã€‚</p>
<h2 id="é€»è¾‘-æ“ä½œç¬¦">é€»è¾‘ &amp;&amp; æ“ä½œç¬¦</h2>
<blockquote>
<p>The <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Logical_AND">logical AND operator</a> is usually used with Boolean values in if-statements, but it actually returns the value of one of the operands. <strong>If the first expression can be converted to true, then it returns the second. Otherwise, it returns the first.</strong></p>
</blockquote>
<p>åªè¦ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸º falseï¼Œå°±è¿”å›ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼›å¦‚æœç¬¬ä¸€ä¸ªä¸º trueï¼Œåˆ™è¿”å›ç¬¬äºŒä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚</p>
<pre><code class="language-javascript">&quot;&quot; &amp;&amp; -0; // -&gt; &quot;&quot;
-0 &amp;&amp; &quot;&quot;; // -&gt; -0
5 &amp;&amp; 3; // -&gt; 3
0 &amp;&amp; 3; // -&gt; 0
</code></pre>
<h1 id="ç»ƒä¹ é¢˜">ç»ƒä¹ é¢˜</h1>
<h2 id="1">1.</h2>
<pre><code class="language-javascript">[] == ![]
</code></pre>
<p>å³è¾¹å…ˆè½¬åŒ–ä¸ºå¸ƒå°”å€¼ã€‚ç”±äº <code>[]</code> æ˜¯ truthy å€¼ï¼Œæ‰€ä»¥ <code>![]</code> æ˜¯ falseã€‚</p>
<p><code>[] == false</code>ï¼Œä¸€è¾¹ä¸ºå¼•ç”¨ç±»å‹ï¼Œä¸€è¾¹ä¸ºå¸ƒå°”ç±»å‹ã€‚åªè¦æœ‰ä¸€è¾¹æ˜¯å¸ƒå°”ï¼Œå°±å…ˆå°†å¸ƒå°”ç±»å‹è½¬ä¸º numberã€‚</p>
<p><code>[] == 0</code>, ä¸€è¾¹ä¸º <code>number</code> ç±»å‹ï¼ˆé  boolean çš„åŸå§‹ç±»å‹ï¼‰ï¼Œä¸€è¾¹ä¸ºå¼•ç”¨ç±»å‹ã€‚åˆ™å…ˆå°†å¼•ç”¨ç±»å‹è½¬ä¸ºåŸå§‹ç±»å‹ã€‚</p>
<p><code>'' == 0</code>ã€‚ä¸€è¾¹ä¸º string ç±»å‹ï¼Œä¸€è¾¹ä¸º number ç±»å‹ã€‚åˆ™å…ˆå°† string è½¬ä¸º numberã€‚</p>
<p><code>0 == 0</code>ã€‚åˆ™æœ€åä¸º <code>true</code>ã€‚</p>
<h2 id="2">2.</h2>
<pre><code class="language-javascript">true == &quot;true&quot; 
</code></pre>
<p><code>1 == &quot;true&quot;</code> -&gt; <code>1 == NaN</code>ï¼Œåˆ™æœ€åä¸º <code>false</code>ã€‚</p>
<h2 id="3">3.</h2>
<pre><code class="language-javascript">010 - 03
</code></pre>
<pre><code>010; // -&gt; 8
03; // -&gt; 3
8 - 3; // -&gt; 5
</code></pre>
<p>æ‰€ä»¥ç­”æ¡ˆä¸º5ã€‚</p>
<h2 id="4">4.</h2>
<pre><code class="language-javascript">1/0 &gt; 10 ** 1000
</code></pre>
<blockquote>
<p>JavaScript treats both of these values as infinite, and infinity is equal to infinity. <a href="https://en.wikipedia.org/wiki/Floating-point_arithmetic#Infinities">Learn more about infinities</a>.</p>
</blockquote>
<pre><code class="language-javascript">1/0; // -&gt; Infinity
10 ** 1000; // -&gt; Infinity
Infinity &gt; Infinity; // -&gt; false
</code></pre>
<p>æ‰€ä»¥ç­”æ¡ˆä¸º falseã€‚</p>
<h2 id="5">5.</h2>
<pre><code class="language-javascript">true++
</code></pre>
<p>è¾“å‡º stytaxErrorã€‚</p>
<p>åªèƒ½æ­»è®°ä¸‹é¢çš„å€¼äº†ï¼š</p>
<pre><code class="language-javascript">true++; // -&gt; SyntaxError
1++; // -&gt; SyntaxError
&quot;x&quot;++; // -&gt; SyntaxError
null++; // -&gt; SyntaxError
undefined++; // -&gt; NaN
$++; // -&gt; NaN
console.log++; // -&gt; NaN
NaN++; // -&gt; NaN

let _true = true;
_true++;
_true; // -&gt; 2
</code></pre>
<h2 id="6">6.</h2>
<pre><code class="language-javascript">undefined + false
</code></pre>
<blockquote>
<p>While false can be converted to a number, undefined cannot.<br>
<code>Number(undefined); // -&gt; NaN</code><br>
<code>Number(false); // -&gt; 0</code><br>
<code>NaN + 0; // -&gt; NaN</code></p>
</blockquote>
<h2 id="7">7.</h2>
<pre><code class="language-javascript">&quot;&quot; &amp;&amp; -0
</code></pre>
<p>è€ƒå¯Ÿ<code>&amp;&amp;</code>è¿ç®—ç¬¦çš„é€»è¾‘ã€‚<br>
ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸º falseï¼Œç›´æ¥è¿”å›ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚<br>
ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸º trueï¼Œåˆ™è¿”å›ç¬¬äºŒä¸ªè¡¨è¾¾å¼çš„å€¼ã€‚</p>
<p>æ­¤é¢˜ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼ä¸º false ï¼Œåˆ™è¿”å›ç¬¬ä¸€ä¸ªï¼Œå³ <code>&quot;&quot;</code>ã€‚</p>
<h1 id="å‚è€ƒ">å‚è€ƒ</h1>
<p><a href="https://chinese.freecodecamp.org/news/javascript-implicit-type-conversion/">JavaScript éšå¼ç±»å‹è½¬æ¢ï¼Œä¸€ç¯‡å°±å¤Ÿäº†ï¼</a></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[é¢è¯•å®˜ï¼šå®ç°ä¸€ä¸ªè‡ªå·±çš„ Promise å§ï¼(WIP)]]></title>
        <id>https://CallanBi.github.io/post/mian-shi-guan-shi-xian-yi-ge-zi-ji-de-promise-ba/</id>
        <link href="https://CallanBi.github.io/post/mian-shi-guan-shi-xian-yi-ge-zi-ji-de-promise-ba/">
        </link>
        <updated>2022-04-21T14:52:23.000Z</updated>
        <content type="html"><![CDATA[<p>ä»Šå¤©é¢è¯•å®˜é—®äº†æˆ‘è¿™ä¸ªé—®é¢˜ï¼Œå†™å¾—ç£•ç£•ç»Šç»Šçš„ï¼Œæœ€åä¹Ÿæ²¡å†™å‡ºæ¥ï¼Œå¤ç›˜ä¸€ä¸‹ã€‚</p>
<p>Promise çš„æœ¬è´¨ï¼šå›è°ƒå‡½æ•°ï¼Œè¢«å°è£…åœ¨å†…éƒ¨ã€‚</p>
<p>å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/58428287">è¿™ç¯‡æ–‡ç« </a>ï¼Œæˆ‘å…ˆå®ç°äº†ä¸€ä¸ªåŸºç¡€çš„ Promiseï¼š</p>
<pre><code class="language-javascript">class MyPromise {
    static cbs: Array&lt;(val: any) =&gt; any&gt; = [];

    static errorCbs: Array&lt;(err: any) =&gt; any&gt; = [];

    status: 'pending' | 'fulfilled' | 'rejected' = 'pending';

    data: any = undefined;

    constructor(callback: (resolve: MyPromise['resolve'], reject: MyPromise['reject']) =&gt; any) {
        try {
            callback(this.resolve, this.reject);
        } catch (e) {
            this.reject(e);
        }
    }

    resolve = (val: any) =&gt; {
        this.status = 'fulfilled';

        setTimeout(() =&gt; {
            // åŠ ä¸Š setTimeout æ˜¯ä¸ºäº†ç¡®ä¿ cbs é•¿åº¦å¤§äº0
            MyPromise.cbs.forEach(f =&gt; f(val));
        });

        this.data = val;
    }

    reject = (reason: any) =&gt; {
        this.status = 'rejected';
        setTimeout(() =&gt; {
            MyPromise.errorCbs.forEach(f =&gt; f(reason));
        })

        this.data = reason;
    }

    then = (fun: (data: any) =&gt; any) =&gt; {
        MyPromise.cbs.push(fun);
        return this;
    }

    catch = (onRejected: (err: any) =&gt; any) =&gt; {
        setTimeout(() =&gt; {
            MyPromise.errorCbs.push(onRejected);
        });
        return this;
    }
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[TSç»å…¸ç±»å‹ä½“æ“ï¼šè”åˆç±»å‹å¦‚ä½•è½¬ä¸ºè½¬äº¤å‰ç±»å‹ï¼Ÿéœ€è¦çŸ¥é“ä¸‰ä¸ªç‚¹ï¼šåˆ†é…å¾‹ã€é€†å˜ä½ç½®ã€é€†å˜å’Œåå˜]]></title>
        <id>https://CallanBi.github.io/post/dang-ts-de-lian-he-lei-xing-he-jiao-cha-lei-xing-yu-dao-han-shu/</id>
        <link href="https://CallanBi.github.io/post/dang-ts-de-lian-he-lei-xing-he-jiao-cha-lei-xing-yu-dao-han-shu/">
        </link>
        <updated>2022-03-24T03:06:00.000Z</updated>
        <content type="html"><![CDATA[<p>æ¥çœ‹ä¸€ä¸ªç»å…¸çš„ç±»å‹ä½“æ“é—®é¢˜ï¼šå¦‚ä½•å®ç°ä¸€ä¸ª UnionToIntersectionï¼Ÿ</p>
<p>å…·ä½“åœ°è¯´ï¼Œè¿™ä¸ªé—®é¢˜æœ‰ä¸‰ä¸ªå­é—®é¢˜ï¼šè”åˆç±»å‹çš„åˆ†é…å¾‹ã€ é€†å˜ä½ç½®ã€é€†å˜å’Œåå˜ã€‚æˆ‘ä»¬åœ¨é€’å½’åœ°è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œé€’å½’åœ°ç»™å‡ºè§£ç­”ã€‚</p>
<pre><code>// test case
type U = UnionToIntersection&lt;{ a: string } | { b: number }&gt; // type U = {  a: string } &amp; { b: number };
</code></pre>
<p>æ³¨æ„ï¼Œè¾“å…¥ä¸èƒ½æ˜¯åŸå§‹ç±»å‹çš„è”åˆç±»å‹ï¼Œå› ä¸ºåŸå§‹ç±»å‹çš„äº¤å‰ç±»å‹æ˜¯ <code>never</code>ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œå°±è¦ç”¨åˆ°è¿™ä¸¤ä¸ªç±»å‹ä¸å‡½æ•°çš„å¥‡å¦™ç¢°æ’äº†ã€‚</p>
<h2 id="è”åˆç±»å‹çš„åˆ†é…å¾‹">è”åˆç±»å‹çš„åˆ†é…å¾‹</h2>
<p>æˆ‘ä»¬çŸ¥é“è”åˆç±»å‹éµä»åˆ†é…å¾‹ã€‚å½“æˆ‘ä»¬å°†ä¸€ä¸ªè”åˆç±»å‹å¦‚ <code>{ a: string } | { b: number }</code> ä¼ å…¥ä¸€ä¸ªç±»å‹ <code>type T&lt;U&gt;</code> æ—¶ï¼Œ<code>type T&lt;{ a: string } | { b: number }&gt;</code> å®é™…ä¸Šç­‰ä»·äº <code>type T&lt;{ a: string }&gt; | type T&lt;{ b: number }&gt;</code>ã€‚</p>
<p>ä¸‹é¢è¿™ä¸ªæ˜¯<a href="https://www.typescriptlang.org/docs/handbook/2/conditional-types.html">å®˜ç½‘</a>çš„è§£é‡Šã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://CallanBi.github.io/post-images/1650297261036.png" alt="" loading="lazy"></figure>
<p>é‚£å¦‚æœæˆ‘ä»¬æŠŠ <code>type T&lt;U&gt;</code> å†™æˆè¿™ä¸ªæ ·å­ï¼š</p>
<pre><code>type ToUnionOfFunction&lt;T&gt; = T extends any ? (x: T) =&gt; any : never;
</code></pre>
<p>å³ï¼Œæˆ‘ä»¬æ„é€ ä¸€ä¸ªå°†ä¼ å…¥çš„è”åˆç±»å‹ä½œä¸ºå‚æ•°çš„å‡½æ•°ã€‚æˆ‘ä»¬å°†ä¸Šé¢çš„ test case ä¼ å…¥è¿™ä¸ªç±»å‹ï¼š</p>
<pre><code>type Functions = ToUnionOfFunction&lt;{ a: string } | { b: number }&gt; 
</code></pre>
<p>è¿™ä¸ªæ—¶å€™ï¼Œç»“æœå°±å˜æˆäº†ï¼š</p>
<pre><code>type Functions =
    | ((x: { a: string }) =&gt; any)
    | ((x: { b: number }) =&gt; any)
</code></pre>
<p>ç”±äºåˆ†é…å¾‹ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸¤ä¸ªå‚æ•°ä¸åŒçš„å‡½æ•°çš„è”åˆç±»å‹ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ€ä¹ˆå¾—åˆ°äº¤å‰ç±»å‹å‘¢ï¼Ÿ</p>
<p>é”µé”µï¼çœ‹ä¸‹é¢ï¼</p>
<pre><code>type UnionToIntersection&lt;T&gt; =  ToUnionOfFunction&lt;T&gt; extends (x: infer P) =&gt; any ? P : never;
</code></pre>
<p>æˆ‘ä»¬å°†<code>ToUnionOfFunction&lt;T&gt;</code> è§£å¼€åä¾¿æ˜¯ <code>(( (x: { a: string }) =&gt; any) | ( (x: { b: number }) =&gt; any) ) extends (x: infer P)  =&gt; any ? P : never</code> ã€‚</p>
<p>åœ¨ TypeScript çš„<a href="https://github.com/Microsoft/TypeScript/pull/21496">è¿™ä¸ª PR </a>ä¸­æœ‰ä¸€å¥è¯ï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://CallanBi.github.io/post-images/1650299061909.png" alt="" loading="lazy"></figure>
<blockquote>
<p>multiple candidates for the same type variable in contra-variant positions causes an intersection type to be inferred.</p>
</blockquote>
<p>å³ï¼šåœ¨<strong>é€†å˜ä½ç½®</strong>çš„åŒä¸€ç±»å‹å˜é‡ä¸­çš„å¤šä¸ªå€™é€‰ä¼šè¢«æ¨æ–­æˆäº¤å‰ç±»å‹ã€‚</p>
<p>åŸºäºè¿™ä¸ªæ€§è´¨ï¼Œæˆ‘ä»¬çš„<code>UnionToIntersection&lt;T&gt;</code>ä¾¿æ»¡è¶³æµ‹è¯•ç”¨ä¾‹äº†ã€‚</p>
<h2 id="é€†å˜ä½ç½®åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆ">é€†å˜ä½ç½®åˆ°åº•æ˜¯ä¸ªä»€ä¹ˆï¼Ÿ</h2>
<p>é¦–å…ˆè®°ä½ä¸€å¥è¯ï¼šå‡½æ•°å‚æ•°æ˜¯é€†å˜çš„ï¼Œè€Œå¯¹è±¡å±æ€§æ˜¯åå˜çš„ã€‚</p>
<p>å˜é‡å¤„äºé€†å˜ä½ç½®å°±æ˜¯<strong>è¿™ä¸ªå˜é‡æ˜¯ä¸€ä¸ªå‡½æ•°çš„å‚æ•°</strong>ã€‚</p>
<h2 id="åˆ°åº•ä»€ä¹ˆæ˜¯é€†å˜å’Œåå˜">åˆ°åº•ä»€ä¹ˆæ˜¯é€†å˜å’Œåå˜ï¼Ÿï¼</h2>
<p>åœ¨<a href="https://jkchao.github.io/typescript-book-chinese/tips/covarianceAndContravariance.html#%E4%B8%80%E4%B8%AA%E6%9C%89%E8%B6%A3%E7%9A%84%E9%97%AE%E9%A2%98">ã€Šæ·±å…¥ç†è§£ TypeScriptã€‹</a> çš„ é€†å˜å’Œåå˜ ä¸€èŠ‚ä¸­æœ‰è¯¦ç»†ä»‹ç»ã€‚</p>
<p>ã€Šæ·±å…¥ç†è§£ TypeScriptã€‹æ˜¯æœ¬å¥½ä¹¦å‘€ï¼Œå»ºè®®å¤šçœ‹çœ‹ã€‚</p>
<p>OKï¼Œè¿™ä¸‰ä¸ªé—®é¢˜è§£å†³å®Œä¹‹åï¼Œæˆ‘ä»¬å¯¹è¿™ä¸ªç»å…¸é—®é¢˜ä¹Ÿç®—æ˜¯ææ‡‚äº†ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ä¸€ä¸ªå‰ç«¯çš„ Golang è¯­æ³•å±‚é¢å…¥é—¨æ„Ÿæ‚Ÿï¼ˆæŒç»­è¡¥å……ï¼‰]]></title>
        <id>https://CallanBi.github.io/post/yi-ge-qian-duan-de-golang-ji-chu-xue-xi-gan-wu/</id>
        <link href="https://CallanBi.github.io/post/yi-ge-qian-duan-de-golang-ji-chu-xue-xi-gan-wu/">
        </link>
        <updated>2021-10-23T12:53:01.000Z</updated>
        <content type="html"><![CDATA[<p>å†™æœ¬æ–‡ä¸»è¦æƒ³å¯¹æ¯”ä¸‹ Golang å’Œé€šå¸¸å‰ç«¯æ‰€ç”¨çš„æ—¥å¸¸å¼€å‘è¯­è¨€ï¼Œå¦‚ JS å’Œ TS ä¹‹é—´çš„å¼‚åŒï¼Œä»¥ä¾¿æ›´å¥½åœ°åˆ‡æ¢å¼€å‘æ—¶çš„å¿ƒæ™ºæ¨¡å¼ã€‚</p>
<h1 id="å…³äºå˜é‡ä½œç”¨åŸŸ">å…³äºå˜é‡ä½œç”¨åŸŸ</h1>
<p>Golang çš„ä½œç”¨åŸŸå¥½åƒä¸ ES6 çš„ let å˜é‡ä½œç”¨åŸŸç›¸åŒã€‚</p>
<p><strong>The Way To Go ä¸­çš„ä¾‹å­</strong></p>
<ol>
<li>è¾“å‡º GOG</li>
</ol>
<pre><code class="language-python">package main

var a = &quot;G&quot;

func main() {
   n()
   m()
   n()
}

func n() { print(a) }

func m() {
   a := &quot;O&quot;
   print(a)
}
</code></pre>
<ol start="2">
<li>è¾“å‡º GOO</li>
</ol>
<pre><code class="language-python">package main

var a = &quot;G&quot;

func main() {
   n()
   m()
   n()
}

func n() {
   print(a)
}

func m() {
   a = &quot;O&quot;
   print(a)
}
</code></pre>
<ol start="3">
<li>è¾“å‡ºGOG</li>
</ol>
<pre><code class="language-python">package main

var a string

func main() {
   a = &quot;G&quot;
   print(a)
   f1()
}

func f1() {
   a := &quot;O&quot;
   print(a)
   f2()
}

func f2() {
   print(a)
}
</code></pre>
<p>æ³¨æ„ <code>f2()</code> ä¸­çš„ <code>print(a)</code>ï¼Œè¯»çš„æ˜¯å…¨å±€å˜é‡<code>a</code>ï¼Œè€Œä¸æ˜¯å‡½æ•°æ‰§è¡ŒåŸŸä¸­<code>f1()</code>çš„<code>a</code>ã€‚</p>
<h1 id="å…³äºåŒ…å¯¼å‡º">å…³äºåŒ…å¯¼å‡º</h1>
<p>Golang é€šå¸¸ä¸€ä¸ªç›®å½•ä¸ºä¸€ä¸ªåŒ…ï¼ˆpackageï¼‰ã€‚ä¸åƒ JS ä¸­å¸¸è§çš„åŒ…ç®¡ç†æœºåˆ¶ï¼ˆå¦‚ ESMç­‰ï¼‰ï¼ŒGolang åŒ…å†…æˆå‘˜ä¸éœ€è¦ç”¨<code>export</code>ç­‰å…³é”®å­—æ˜¾å¼å£°æ˜å¯¼å‡ºã€‚</p>
<p>å¯¼å‡ºçš„æˆå‘˜å‡½æ•°åº”<strong>ä»¥å¤§å†™å­—æ¯å¼€å¤´</strong>ï¼Œå¦åˆ™ä¸å¯ä»¥å¯¼å‡ºï¼ˆGoland IDE å¦‚æœå¼•ç”¨äº†åŒ…å†…å°å†™çš„å‡½æ•°ï¼Œä¼šæœ‰æŠ¥é”™æç¤ºï¼Œç‚¹å‡»å¯¼å‡ºå IDE ä¼šå°†å‡½æ•°å¼€å¤´æ”¹æˆå¤§å†™å­—æ¯ï¼‰ã€‚</p>
<h1 id="ä¸‰-å˜å‚å‡½æ•°">ä¸‰ã€å˜å‚å‡½æ•°</h1>
<p>Golang çš„å˜å‚å‡½æ•°ç±»ä¼¼äºè§£æ„èµ‹å€¼ï¼Œä½†æœ‰ç•¥å¾®ä¸åŒã€‚å¦‚ <strong>The Way To Go</strong> ä¸­çš„ä¾‹å­ã€‚</p>
<ol>
<li>å½“å˜å‚å‡½æ•°æƒ³è¦æ‹¿åˆ°å‰©ä½™å˜é•¿å‚æ•°æ‰€ç»„æˆçš„åˆ‡ç‰‡ï¼Œåœ¨è¡¨ç¤ºåˆ‡ç‰‡ç±»å‹æ—¶ï¼Œç±»ä¼¼è§£æ„èµ‹å€¼çš„ä¸‰ç‚¹è¿ç®—å†™åœ¨å‰é¢ï¼š</li>
</ol>
<pre><code class="language-python">func Greeting(prefix string, who ...string) // ...string è¡¨ç¤º []string è¿™ä¸€åˆ‡ç‰‡ç±»å‹
Greeting(&quot;hello:&quot;, &quot;Joe&quot;, &quot;Anna&quot;, &quot;Eileen&quot;)
</code></pre>
<ol start="2">
<li>å½“å°†åˆ‡ç‰‡ä¼ é€’ç»™å˜å‚å‡½æ•°æ—¶ï¼Œç±»ä¼¼è§£æ„èµ‹å€¼çš„ä¸‰ç‚¹è¿ç®—å†™åœ¨åˆ‡ç‰‡å˜é‡åé¢ï¼š</li>
</ol>
<pre><code class="language-python">package main

import &quot;fmt&quot;

func main() {
    x := min(1, 3, 2, 0)
    fmt.Printf(&quot;The minimum is: %d\n&quot;, x)
    slice := []int{7,9,3,5,1}
    x = min(slice...) // å†™åœ¨åé¢
    fmt.Printf(&quot;The minimum in the slice is: %d&quot;, x)
}

func min(s ...int) int {
    if len(s) == 0 {
        return 0
    }
    min := s[0]
    for _, v := range s {
        if v &lt; min {
            min = v
        }
    }
    return min
}
</code></pre>
<h1 id="å…³äºç»“æ„ä½“çš„ç±»å‹">å…³äºç»“æ„ä½“çš„ç±»å‹</h1>
<p>æˆ‘ä»¬çŸ¥é“åœ¨ TypeScript ä¸­ï¼Œå¯¹è±¡çš„ç±»å‹åªè¦å½¢çŠ¶ä¸€è‡´ï¼Œå³è®¤ä¸ºè¯¥å¯¹è±¡å±äºæŸä¸€ç±»å‹ï¼š</p>
<pre><code class="language-javascript">type Options = {
  par1: string;
  par2: number;
  par3: any;
}

const instance1: Options = {
  par1: &quot;aaa&quot;,
  par2: 123,
  par3: &quot;bbb&quot;,
}

const instance2 = {
  par1: &quot;aaa&quot;,
  par2: 123,
  par3: &quot;bbb&quot;,
}

const instance3: Options = instance2; // æ— æŠ¥é”™
</code></pre>
<p>ä½†åœ¨ Golang ä¸­å¹¶éå¦‚æ­¤ã€‚ä¾‹å­åœ¨ä¸‹é¢ï¼š</p>
<p><strong>varargs.go</strong></p>
<pre><code class="language-python">package varargs

import (
  &quot;fmt&quot;
)

type Options struct {
  Par1 string
  Par2 int64
  Par3 interface{}
}

func PrintVarArgsUsingStruct(para *Options) {
  fmt.Print(&quot;\n\nPrintVarArgsUsingStruct: &quot;, *para)
}
</code></pre>
<p><strong>sturcttest.go</strong></p>
<pre><code class="language-python">package structtest

import (
  &quot;fmt&quot;

  &quot;goSimplePractice/varargs&quot;
)

func Test() {
  fmt.Print(&quot;\n\nstructTest: &quot;)

  varMadeFromType := &amp;varargs.Options{Par1: &quot;123&quot;, Par2: 19980416, Par3: &quot;testTestTest&quot;}
  varMadeFromStruct := &amp;struct {
    Par1 string
    Par2 int64
    Par3 interface{}
  }{Par1: &quot;123&quot;, Par2: 19980416, Par3: &quot;testTestTest&quot;}

  varargs.PrintVarArgsUsingStruct(varMadeFromType)

  // varargs.PrintVarArgsUsingStruct(varMadeFromStruct)
  // Output: Cannot use 'varMadeFromStruct' (type *struct {...}) as the type *Options

  varargs.PrintVarArgsUsingStruct((*varargs.Options)(varMadeFromStruct)) // âœ…
}
</code></pre>
<p>äº‹å®ä¸Šï¼Œåœ¨ golang ç­‰å¼ºç±»å‹è¯­è¨€ä¸­æ— å½¢çŠ¶è¿™ä¸€è¯´æ³•ï¼Œå› ä¸º golang ä¸æ˜¯åŠ¨æ€ç±»å‹è¯­è¨€ï¼Œæ— éœ€ä¸ºå…¼å®¹å¼±ç±»å‹çš„å¯¹è±¡åšå¦¥åã€‚ä½†æœ‰å®Œå…¨ç›¸åŒã€Œå½¢çŠ¶ã€ï¼Œå³å®Œå…¨ç›¸åŒçš„å­—æ®µï¼ˆåå­—ã€ä¸ªæ•°å’Œç±»å‹ï¼‰çš„ç»“æ„ä½“å¯ä»¥äº’ç›¸è½¬æ¢ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[TypeScript + React ä¸ªäººæœ€ä½³å®è·µ(WIPæŒç»­è¡¥å……ä¸­)]]></title>
        <id>https://CallanBi.github.io/post/typescript-react-ge-ren-zui-jia-shi-jian-wip-chi-xu-bu-chong-zhong/</id>
        <link href="https://CallanBi.github.io/post/typescript-react-ge-ren-zui-jia-shi-jian-wip-chi-xu-bu-chong-zhong/">
        </link>
        <updated>2021-07-03T16:11:47.000Z</updated>
        <content type="html"><![CDATA[<h1 id="å‰ç½®å·¥ä½œ">å‰ç½®å·¥ä½œ</h1>
<ol>
<li><a href="https://reactjs.org/docs/static-type-checking.html#typescript">é˜…è¯»React Doc ä¸­ TS éƒ¨åˆ†</a></li>
<li><a href="https://reactjs.org/docs/static-type-checking.html#typescript">é˜…è¯» TypeScript Playground ä¸­ React éƒ¨åˆ†</a></li>
</ol>
<h1 id="å¼•å…¥-reactæ°¸è¿œä½¿ç”¨å‘½åç©ºé—´å¯¼å…¥namespace-import">å¼•å…¥ Reactï¼šæ°¸è¿œä½¿ç”¨å‘½åç©ºé—´å¯¼å…¥ï¼ˆnamespace importï¼‰</h1>
<pre><code class="language-javascirpt">import * as React from 'react';
import { useState } from 'react'; // å¯ä»¥å•ç‹¬å¯¼å‡ºä¸€éå†…éƒ¨é¡¹
import * as ReactDom from 'react-dom';
</code></pre>
<p>ä¸æ¨è <code>import React from 'react'</code>ã€‚<a href="https://twitter.com/dan_abramov/status/1308739731551858689">ğŸ‘‰ä¸ºä»€ä¹ˆï¼Ÿ</a><br>
è¿™ç§å¼•å…¥æ–¹å¼è¢«ç§°ä¸º <code>default export</code> ã€‚ä¸æ¨èçš„åŸå› æ˜¯ç¬¬React ä»…ä»…æ˜¯ä½œä¸ºä¸€ä¸ªå‘½åç©ºé—´å­˜åœ¨çš„ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šåƒä½¿ç”¨ä¸€ä¸ªå€¼ä¸€æ ·æ¥ä½¿ç”¨ Reactã€‚ä» React 16.13.0 å¼€å§‹ï¼ŒReact çš„å¯¼å‡ºæ–¹å¼ä¹Ÿå·²ç»æ›´æ­£ä¸º <code>export {xxx, ...} </code>çš„å½¢å¼äº†(<a href="https://github.com/facebook/react/commit/60016c448bb7d19fc989acd05dda5aca2e124381#diff-a9c08afc9ba1304a73e4235b3016b97c">commit</a>)ã€‚ä¹‹æ‰€ä»¥<code>default export</code>è¿˜å¯ä»¥ä½¿ç”¨ï¼Œæ˜¯å› ä¸ºç›®å‰ React çš„æ„å»ºäº§ç‰©æ˜¯ Commonjs è§„èŒƒçš„ï¼Œwebpack ç­‰æ„å»ºå·¥å…·åšäº†å…¼å®¹ã€‚</p>
<h1 id="ç»„ä»¶å¼€å‘">ç»„ä»¶å¼€å‘</h1>
<h2 id="1-å°½é‡ä½¿ç”¨function-componentå£°æ˜å³-reactfc">1. å°½é‡ä½¿ç”¨Function Componentå£°æ˜ï¼Œå³ React.FCï¼š</h2>
<pre><code class="language-javascript">export interface Props {
  /** The user's name */
  name: string;
  /** Should the name be rendered in bold */
  priority?: boolean
}

const PrintName: React.FC&lt;Props&gt; = (props) =&gt; {
  return (
    &lt;div&gt;
      &lt;p style={{ fontWeight: props.priority ? &quot;bold&quot; : &quot;normal&quot; }}&gt;{props.name}&lt;/p&gt;
    &lt;/div&gt;
  )
}
</code></pre>
<p>æˆ‘ä¸€èˆ¬åœ¨å¼€å‘æ—¶ä½¿ç”¨ vscode snippets å¿«é€Ÿç”Ÿæˆï¼š</p>
<pre><code class="language-json">&quot;Functional, Folder Name&quot;: {
    &quot;prefix&quot;: &quot;ff&quot;,
    &quot;body&quot;: [
      &quot;import * as React from 'react';&quot;,
      &quot;&quot;,
      &quot;const { useRef, useState, useEffect, useMemo } = React;&quot;,
      &quot;&quot;,
      &quot;&quot;,
      &quot;interface ${TM_DIRECTORY/.*[\\\\\\\\\\\\/](.*)$/$1/}Props {&quot;,
      &quot;&quot;,
      &quot;}&quot;,
      &quot;&quot;,
			&quot;const defaultProps: ${TM_DIRECTORY/.*[\\\\\\\\\\\\/](.*)$/$1/}Props = {};&quot;,
			&quot;&quot;,
      &quot;const ${TM_DIRECTORY/.*[\\\\\\\\\\\\/](.*)$/$1/}: React.FC&lt;${TM_DIRECTORY/.*[\\\\\\\\\\\\/](.*)$/$1/}Props&gt; = (props: React.PropsWithChildren&lt;${TM_DIRECTORY/.*[\\\\\\\\\\\\/](.*)$/$1/}Props&gt; = defaultProps) =&gt; {&quot;,
      &quot;  const { } = props;&quot;,
      &quot;&quot;,
      &quot;  return (&quot;,
      &quot;&quot;,
      &quot;  );&quot;,
      &quot;};&quot;,
      &quot;&quot;,
      &quot;export default ${TM_DIRECTORY/.*[\\\\\\\\\\\\/](.*)$/$1/};&quot;,
      &quot;&quot;
    ],
    &quot;description&quot;: &quot;Generate a functional component template&quot;
  },
</code></pre>
<h1 id="hook-ç›¸å…³">Hook ç›¸å…³</h1>
<p>æ¨èå®‰è£…vscode æ’ä»¶ï¼š<a href="https://marketplace.visualstudio.com/items?itemName=AlDuncanson.react-hooks-snippets">React Hooks Snippets</a> å¿«é€Ÿå†™ hookï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚</p>
<h2 id="2-usestatet-å½“çŠ¶æ€åˆå§‹å€¼ä¸ºç©ºæ—¶æ¨èå†™å‡ºå®Œæ•´æ³›å‹å¦åˆ™å¯ä»¥è‡ªåŠ¨æ¨æ–­ç±»å‹">2. useState<T>ï¼š å½“çŠ¶æ€åˆå§‹å€¼ä¸ºç©ºæ—¶ï¼Œæ¨èå†™å‡ºå®Œæ•´æ³›å‹ï¼Œå¦åˆ™å¯ä»¥è‡ªåŠ¨æ¨æ–­ç±»å‹ã€‚</h2>
<p>åŸå› ï¼šä¸€äº›çŠ¶æ€åˆå§‹å€¼ä¸ºç©ºæ—¶ï¼Œéœ€è¦æ˜¾ç¤ºåœ°å£°æ˜ç±»å‹ï¼š</p>
<pre><code class="language-javascript">const [user, setUser] = React.useState&lt;User | null&gt;(null)
</code></pre>
<p>æ³¨æ„ï¼šå¦‚æœåˆå§‹å€¼ä¸º undefinedï¼Œå¯ä¸ç”¨åœ¨æ³›å‹ä¸­åŠ ä¸Š undefinedã€‚</p>
<h2 id="3-usememo-å’Œ-usecallback-ä¼šéšå¼æ¨æ–­ç±»å‹æ¨èä¸ä¼ æ³›å‹">3. useMemo() å’Œ useCallback() ä¼šéšå¼æ¨æ–­ç±»å‹ï¼Œæ¨èä¸ä¼ æ³›å‹</h2>
<p>æ³¨ï¼šä¸è¦ç»å¸¸ç”¨useCallbackï¼Œå› ä¸ºä¹Ÿä¼šå¢åŠ å¼€é”€ã€‚ä»…å½“ï¼š</p>
<ul>
<li>åŒ…è£…åœ¨ <code>React.memo()</code>ï¼ˆæˆ– shouldComponentUpdate ï¼‰ä¸­çš„ç»„ä»¶æ¥å—å›è°ƒ prop;</li>
<li>å½“å‡½æ•°ç”¨ä½œå…¶ä»– hooks çš„ä¾èµ–é¡¹æ—¶ <code>useEffect(...ï¼Œ[callback])</code>ã€‚</li>
</ul>
<h2 id="4-è‡ªå®šä¹‰hookå¦‚æœè¿”å›ä¸ºæ•°ç»„éœ€è¦æ‰‹åŠ¨æ·»åŠ -const-æ–­è¨€">4. è‡ªå®šä¹‰hookå¦‚æœè¿”å›ä¸ºæ•°ç»„ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ  const æ–­è¨€ï¼š</h2>
<pre><code class="language-javascript">function useLoading() {
  const [isLoading, setLoading] = React.useState(false);
  const load = (aPromise: Promise&lt;any&gt;) =&gt; {
    setLoading(true)
    return aPromise.then(() =&gt; setLoading(false));
  }
  // å®é™…éœ€è¦: [boolean, typeof load] ç±»å‹
  // è€Œä¸æ˜¯è‡ªåŠ¨æ¨å¯¼çš„ï¼š(boolean | typeof load)[]
  return [isLoading, load] as const;
}
</code></pre>
<p>æˆ–è€…å¯ä»¥ç›´æ¥å®šä¹‰è¿”å›ç±»å‹ï¼š</p>
<pre><code class="language-javascript">export function useLoading(): [
  boolean,
  (aPromise: Promise&lt;any&gt;) =&gt; Promise&lt;any&gt;
] {
  const [isLoading, setState] = React.useState(false)
  const load = (aPromise: Promise&lt;any&gt;) =&gt; {
    setState(true)
    return aPromise.then(() =&gt; setState(false))
  }
  return [isLoading, load]
}
</code></pre>
<h1 id="å…¶ä»–">å…¶ä»–</h1>
<h2 id="5-ä½¿ç”¨é»˜è®¤å‚æ•°å€¼ä»£æ›¿é»˜è®¤å±æ€§">5. ä½¿ç”¨é»˜è®¤å‚æ•°å€¼ä»£æ›¿é»˜è®¤å±æ€§</h2>
<pre><code class="language-javascript">interface GreetProps { age?: number }
const defaultProps: GreetProps = { age: 21 };
const Greet = (props: GreetProps = defaultProps) =&gt; {
  /* ... */
}
</code></pre>
<p>åŸå› ï¼šFunction Component çš„ defaultProps <a href="https://twitter.com/hswolff/status/1133759319571345408">æœ€ç»ˆä¼šè¢«åºŸå¼ƒ</a>ï¼Œä¸æ¨èä½¿ç”¨ã€‚<br>
å¦‚æœä»è¦ä½¿ç”¨defaultPropsï¼Œæ¨èå¦‚ä¸‹æ–¹å¼ï¼š</p>
<pre><code class="language-javascript">interface IProps {
  name: string
}
const defaultProps = {
  age: 25,
};

// ç±»å‹å®šä¹‰
type GreetProps = IProps &amp; typeof defaultProps;
const Greet = (props: GreetProps) =&gt; &lt;div&gt;&lt;/div&gt;
Greet.defaultProps = defaultProps;

// ä½¿ç”¨
const TestComponent = (props: React.ComponentProps&lt;typeof Greet&gt;) =&gt; {
  return &lt;h1 /&gt;
}
const el = &lt;TestComponent name=&quot;foo&quot; /&gt;
</code></pre>
<h2 id="6-å»ºè®®ä½¿ç”¨-interface-å®šä¹‰ç»„ä»¶-propsts-å®˜æ–¹æ¨èåšæ³•ä½¿ç”¨-type-ä¹Ÿå¯ä¸å¼ºåˆ¶">6. å»ºè®®ä½¿ç”¨ Interface å®šä¹‰ç»„ä»¶ propsï¼ˆTS å®˜æ–¹æ¨èåšæ³•ï¼‰ï¼Œä½¿ç”¨ type ä¹Ÿå¯ï¼Œä¸å¼ºåˆ¶</h2>
<p>type å’Œ interface çš„åŒºåˆ«ï¼štype ç±»å‹ä¸èƒ½äºŒæ¬¡ç¼–è¾‘ï¼Œè€Œ interface å¯ä»¥éšæ—¶æ‰©å±•ã€‚</p>
<h2 id="7-ä½¿ç”¨-componentprops-è·å–æœªè¢«å¯¼å‡ºçš„ç»„ä»¶å‚æ•°ç±»å‹ä½¿ç”¨-returntype-è·å–è¿”å›å€¼ç±»å‹">7. ä½¿ç”¨ ComponentProps è·å–æœªè¢«å¯¼å‡ºçš„ç»„ä»¶å‚æ•°ç±»å‹ï¼Œä½¿ç”¨ ReturnType è·å–è¿”å›å€¼ç±»å‹</h2>
<p>è·å–ç»„ä»¶å‚æ•°ç±»å‹ï¼š</p>
<pre><code class="language-javascript">// è·å–å‚æ•°ç±»å‹
import { Button } from 'library' // ä½†æ˜¯æœªå¯¼å‡ºprops type
type ButtonProps = React.ComponentProps&lt;typeof Button&gt; // è·å–props
type AlertButtonProps = Omit&lt;ButtonProps, 'onClick'&gt; // å»é™¤onClick
const AlertButton: React.FC&lt;AlertButtonProps&gt; = props =&gt; (
  &lt;Button onClick={() =&gt; alert('hello')} {...props} /&gt;
)
</code></pre>
<p>è·å–è¿”å›å€¼ç±»å‹ï¼š</p>
<pre><code class="language-javascript">// è·å–è¿”å›å€¼ç±»å‹
function foo() {
  return { baz: 1 }
}
type FooReturn = ReturnType&lt;typeof foo&gt; // { baz: number }
</code></pre>
<h2 id="8-å¯¹-type-æˆ–-interface-è¿›è¡Œæ³¨é‡Šæ—¶å°½é‡ä½¿ç”¨-ä»¥ä¾¿è·å¾—æ›´å¥½çš„ç±»å‹æç¤º">8. å¯¹ type æˆ– interface è¿›è¡Œæ³¨é‡Šæ—¶å°½é‡ä½¿ç”¨ /** */ï¼Œä»¥ä¾¿è·å¾—æ›´å¥½çš„ç±»å‹æç¤º</h2>
<pre><code class="language-javascript">/* âœ… */
/**
 * @param a æ³¨é‡Š1
 * @param b æ³¨é‡Š2
 */
type Test = {
  a: string;
  b: number;
};
const testObj: Test = {
  a: '123',
  b: 234,
};
</code></pre>
<p>å½“ hover åˆ° <code>Test</code> æ—¶ç±»å‹æç¤ºæ›´ä¸ºå‹å¥½ï¼š<br>
<img src="https://CallanBi.github.io/post-images/1625414942775.png" alt="" loading="lazy"></p>
<h2 id="9-ç»„ä»¶-props-ts-ç±»å‹è§„èŒƒ">9. ç»„ä»¶ Props ts ç±»å‹è§„èŒƒ</h2>
<pre><code class="language-javascript">type AppProps = {
  /** string */
  message: string;
  /** number */
  count: number;
  /** boolean */
  disabled: boolean;
  /** åŸºæœ¬ç±»å‹æ•°ç»„ */
  names: string[];
  /** å­—ç¬¦ä¸²å­—é¢é‡ */
  status: 'waiting' | 'success';
  /** å¯¹è±¡ï¼šåˆ—å‡ºå¯¹è±¡å…¨éƒ¨å±æ€§ */
  obj3: {
    id: string;
    title: string;
  };
  /** item ä¸ºå¯¹è±¡çš„æ•°ç»„ */
  objArr: {
    id: string;
    title: string;
  }[];
  /** å­—å…¸*/
  dict: Record&lt;string, MyTypeHere&gt;;
  /** ä»»æ„å®Œå…¨ä¸ä¼šè°ƒç”¨çš„å‡½æ•° */
  onSomething: Function;
  /** æ²¡æœ‰å‚æ•°&amp;è¿”å›å€¼çš„å‡½æ•° */
  onClick: () =&gt; void;
  /** æºå¸¦å‚æ•°çš„å‡½æ•° */
  onChange: (id: number) =&gt; void;
  /** æºå¸¦ç‚¹å‡»äº‹ä»¶çš„å‡½æ•°, ä¸è¦å†ç”¨ e: any äº† */
  onClick(e: React.MouseEvent&lt;HTMLButtonElement&gt;): void;
  /** å¯é€‰çš„å±æ€§ */
  optional?: OptionalType;
  children: React.ReactNode; // æœ€ä½³ï¼Œæ”¯æŒæ‰€æœ‰ç±»å‹(JSX.Element, JSX.Element[], string)
  renderChildren: (name: string) =&gt; React.ReactNode;
  style?: React.CSSProperties;
  onChange?: React.FormEventHandler&lt;HTMLInputElement&gt;; // è¡¨å•äº‹ä»¶
};
</code></pre>
<h2 id="10-ç»„ä»¶ä¸­-event-å¤„ç†">10. ç»„ä»¶ä¸­ event å¤„ç†</h2>
<p>å¸¸è§çš„Eventlç±»å‹ï¼š</p>
<pre><code class="language-javascript">React.SyntheticEvent&lt;T = Element&gt;
React.ClipboardEvent&lt;T = Element&gt;
React.DragEvent&lt;T = Element&gt;
React.FocusEvent&lt;T = Element&gt;
React.FormEvent&lt;T = Element&gt;
React.ChangeEvent&lt;T = Element&gt;
React.KeyboardEvent&lt;T = Element&gt;
React.MouseEvent&lt;T = Element&gt;
React.TouchEvent&lt;T = Element&gt;
React.PointerEvent&lt;T = Element&gt;
React.UIEvent&lt;T = Element&gt;
React.WheelEvent&lt;T = Element&gt;
React.AnimationEvent&lt;T = Element&gt;
React.TransitionEvent&lt;T = Element&gt;
</code></pre>
<p>å®šä¹‰äº‹ä»¶å›è°ƒå‡½æ•°ï¼š</p>
<pre><code class="language-javascript">type changeFn = (e: React.FormEvent&lt;HTMLInputElement&gt;) =&gt; void;
</code></pre>
<p>å¦‚æœä¸å¤ªå…³å¿ƒäº‹ä»¶çš„ç±»å‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ React.SyntheticEventï¼Œå¦‚æœç›®æ ‡è¡¨å•æœ‰æƒ³è¦è®¿é—®çš„è‡ªå®šä¹‰å‘½åè¾“å…¥ï¼Œå¯ä»¥ä½¿ç”¨ç±»å‹æ‰©å±•:</p>
<pre><code class="language-javascript">const App: React.FC = () =&gt; {
  const onSubmit = (e: React.SyntheticEvent) =&gt; {
    e.preventDefault();
    const target = e.target as typeof e.target &amp; {
      password: { value: string; };
    }; // ç±»å‹æ‰©å±•
    const password = target.password.value;
  };
  return (
    &lt;form onSubmit={onSubmit}&gt;
      &lt;div&gt;
        &lt;label&gt;
          Password:
          &lt;input type=&quot;password&quot; name=&quot;password&quot; /&gt;
        &lt;/label&gt;
      &lt;/div&gt;
      &lt;div&gt;
        &lt;input type=&quot;submit&quot; value=&quot;Log in&quot; /&gt;
      &lt;/div&gt;
    &lt;/form&gt;
  );
};
</code></pre>
<h2 id="11-å°½é‡ä½¿ç”¨-optional-channing">11. å°½é‡ä½¿ç”¨ optional channing</h2>
<h2 id="12-å°½é‡ä½¿ç”¨-reactcomponentpropstypeof-component-å‡å°‘éå¿…è¦propså¯¼å‡º">12. å°½é‡ä½¿ç”¨ React.ComponentProps<typeof Component> å‡å°‘éå¿…è¦propså¯¼å‡º</h2>
<h2 id="13-ä¸è¦åœ¨-type-æˆ–-interface-ä¸­ä½¿ç”¨å‡½æ•°å£°æ˜">13. ä¸è¦åœ¨ type æˆ– interface ä¸­ä½¿ç”¨å‡½æ•°å£°æ˜</h2>
<pre><code class="language-javascript">/** âœ… */
interface ICounter {
  start: (value: number) =&gt; string
}

/** âŒ */
interface ICounter1 {
  start(value: number): string
}
</code></pre>
<h2 id="14-å½“å±€éƒ¨ç»„ä»¶ç»“åˆå¤šç»„ä»¶è¿›è¡Œç»„ä»¶é—´çŠ¶æ€é€šä¿¡æ—¶å¦‚æœä¸æ˜¯ç‰¹åˆ«å¤æ‚åˆ™ä¸éœ€è¦ç”¨mobxæˆ–è€…-å»ºè®®ç»“åˆ-usereducer-å’Œ-usecontext-ä¸€èµ·ä½¿ç”¨é¢‘ç¹çš„ç»„ä»¶é—´é€šä¿¡æœ€ä½³å®è·µ">14. å½“å±€éƒ¨ç»„ä»¶ç»“åˆå¤šç»„ä»¶è¿›è¡Œç»„ä»¶é—´çŠ¶æ€é€šä¿¡æ—¶ï¼Œå¦‚æœä¸æ˜¯ç‰¹åˆ«å¤æ‚ï¼Œåˆ™ä¸éœ€è¦ç”¨mobxæˆ–è€… å»ºè®®ç»“åˆ useReducer() å’Œ useContext() ä¸€èµ·ä½¿ç”¨ï¼Œé¢‘ç¹çš„ç»„ä»¶é—´é€šä¿¡æœ€ä½³å®è·µï¼š</h2>
<p><code>Store.ts</code></p>
<pre><code class="language-javascript">import * as React from 'react';

export interface State {
  state1: boolean;
  state2: boolean;
}

export const initState: State = {
  state1: false,
  state2: true,
};

export type Action = 'action1' | 'action2';

export const StoreContext = React.createContext&lt;{
  state: State;
  dispatch: React.Dispatch&lt;Action&gt;;
}&gt;({ state: initState, dispatch: value =&gt; { /** noop */ } });


export const reducer: React.Reducer&lt;State, Action&gt; = (state, action) =&gt; {
 // ç”¨ reducer çš„å¥½å¤„ä¹‹ä¸€æ˜¯å¯ä»¥æ‹¿åˆ°ä¹‹å‰çš„ state
  switch (action) {
    case 'action1':
      return { ...state, state1: !state.state1 };
    case 'action2':
      return { ...state, state2: !state.state2 };
    default:
      return state;
  }
};
</code></pre>
<p><code>WithProvider.tsx</code></p>
<pre><code class="language-javascript">import * as React from 'react';
import { StoreContext, reducer, initState } from './store';

const { useReducer } = React;

const WithProvider: React.FC&lt;Record&lt;string, unknown&gt;&gt; = (props: React.PropsWithChildren&lt;Record&lt;string, unknown&gt;&gt;) =&gt; {
  // å°† state ä½œä¸ºæ ¹èŠ‚ç‚¹çš„çŠ¶æ€æ³¨å…¥åˆ°å­ç»„ä»¶ä¸­
  const [state, dispatch] = useReducer(reducer, initState);
  const { children } = props;

  return &lt;StoreContext.Provider value={{ state, dispatch }}&gt;{children}&lt;/StoreContext.Provider&gt;;
};

export default WithProvider;
</code></pre>
<p>çˆ¶ç»„ä»¶ï¼š</p>
<pre><code class="language-javascript">import * as React from 'react';
import WithProvider from './withProvider';
import Component1 from './components/Component1';
import Component2 from './components/Component2';

const { useRef, useState, useEffect, useMemo } = React;

interface RankProps {}

const defaultProps: RankProps = {};

const Rank: React.FC&lt;RankProps&gt; = (props: React.PropsWithChildren&lt;RankProps&gt; = defaultProps) =&gt; {
  const {} = props;

  return (
    &lt;WithProvider&gt;
      &lt;Component1 /&gt;
      &lt;Component2 /&gt;
    &lt;/WithProvider&gt;
  );
};


export default Rank;

</code></pre>
<p>å­ç»„ä»¶åªéœ€è¦ import <code>StoreContext</code> ä¹‹å <code>useContext()</code> å°±èƒ½å¾—åˆ° state å’Œ dispatch</p>
<pre><code class="language-javascript">import * as React from 'react';
import { StoreContext } from '../../store';

const { useContext } = React;

interface Component1Props {}

const defaultProps: Component1Props = {};

const Component1: React.FC&lt;Component1Props&gt; = (props: React.PropsWithChildren&lt;Component1Props&gt; = defaultProps) =&gt; {
  const { state, dispatch } = useContext(StoreContext);

  const {} = props;

  return (
    &lt;&gt;
      state1: {state.state1 ? 'true' : 'false'}
      &lt;button
        type=&quot;button&quot;
        onClick={(): void =&gt; {
          dispatch('action1');
        }}
      &gt;
        changeState1 with Action1
      &lt;/button&gt;
    &lt;/&gt;
  );
};

export default React.memo(Component1); // å»ºè®®æœ‰context çš„åœ°æ–¹æœ€å¥½ memo ä¸€ä¸‹ï¼Œæé«˜æ€§èƒ½

</code></pre>
<p><code>Store.ts</code> å’Œ <code>WithProvider.tsx</code> å¯ä»¥é…ç½®æˆ vscode snippetsï¼Œéœ€è¦ç”¨åˆ°æ—¶ç›´æ¥ä½¿ç”¨ã€‚</p>
<h2 id="15-ç±»-golang-é£æ ¼çš„å¼‚æ­¥æ¥å£æœ€ä½³å®è·µ">15. ç±» Golang é£æ ¼çš„å¼‚æ­¥æ¥å£æœ€ä½³å®è·µ</h2>
<pre><code class="language-javascript">const asyncTo = &lt;T, E = Error&gt;(p: Promise&lt;T&gt;): Promise&lt;[T, null] | [undefined, E]&gt; =&gt;
  p.then&lt;[T, null]&gt;((data: T) =&gt; [data, null]).catch&lt;[undefined, E]&gt;((err: E) =&gt; [undefined, err]);

const [res1, err1] = await asyncTo(new Promise(resolve =&gt; resolve('success'))); // res1: 'success', err1: null

const [res2, err2] = await asyncTo(new Promise((_, reject) =&gt; reject('error'))); // res2: undefined, err2: 'error'
</code></pre>
<h1 id="å‚è€ƒ">å‚è€ƒ</h1>
<p>[1] <a href="https://mp.weixin.qq.com/s/mUblBpj6pmdxz9mLKEDJTw">React + TypeScript å®è·µ</a><br>
[2] <a href="https://juejin.cn/post/6844903938093744135">ç²¾è¯»ã€ŠReact Hooks æœ€ä½³å®è·µã€‹</a></p>
<p><strong>æ¬¢è¿åœ¨è¯„è®ºæˆ– issue ä¸­è®¨è®ºï¼ŒæŒ‡å‡ºä¸åˆç†ä¹‹å¤„ï¼Œè¡¥å……å…¶ä»–æœ€ä½³å®è·µ~</strong></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ã€è¯‘ã€‘ä½¿ç”¨ Webpack æ‹†åŒ…çš„ 100% æ­£ç¡®çš„åšæ³• / The 100% correct way to split your chunks with Webpack]]></title>
        <id>https://CallanBi.github.io/post/yi-shi-yong-webpack-chai-bao-de-100-zheng-que-de-zuo-fa-the-100-correct-way-to-split-your-chunks-with-webpack/</id>
        <link href="https://CallanBi.github.io/post/yi-shi-yong-webpack-chai-bao-de-100-zheng-que-de-zuo-fa-the-100-correct-way-to-split-your-chunks-with-webpack/">
        </link>
        <updated>2021-05-09T09:45:45.000Z</updated>
        <content type="html"><![CDATA[<!-- more -->
<blockquote>
<p>æŠ€æœ¯ç§¯ç´¯ï¼Œä»ç¿»è¯‘ä¼˜è´¨æ–‡ç« å¼€å§‹ã€‚æœ¬æ–‡ç¿»è¯‘è‡ªï¼š<a href="https://medium.com/hackernoon/the-100-correct-way-to-split-your-chunks-with-webpack-f8a9df5b7758">The 100% correct way to split your chunks with Webpack</a></p>
</blockquote>
<!-- more -->
<p>ä¸ºè‡ªå·±ç½‘ç«™çš„ç”¨æˆ·æ‰¾å‡ºæ¨é€æ–‡ä»¶çš„æœ€å¥½æ–¹å¼æ˜¯ä¸€ä»¶å¾ˆéº»çƒ¦çš„äº‹ã€‚ å¤ªå¤šä¸åŒçš„åœºæ™¯ï¼Œä¸åŒçš„æŠ€æœ¯ï¼Œä¸åŒçš„æœ¯è¯­äº†ã€‚</p>
<p>åœ¨è¿™ç¯‡ Blog ä¸­ï¼Œæˆ‘å¸Œæœ›å‘Šè¯‰ä½ ä½ æƒ³çŸ¥é“çš„ä¸€åˆ‡ï¼Œä½ å¯ä»¥ï¼š</p>
<ol>
<li>
<p>äº†è§£å“ªç§æ–‡ä»¶æ‹†åˆ†ç­–ç•¥æœ€é€‚åˆä½ çš„ç½‘ç«™å’Œç”¨æˆ·</p>
</li>
<li>
<p>çŸ¥é“æ€ä¹ˆå»åš</p>
</li>
</ol>
<p>æ ¹æ® <a href="https://webpack.js.org/glossary/">Webpack è¯æ±‡è¡¨</a>ï¼Œæœ‰ä¸¤ç§ä¸åŒç±»å‹çš„æ–‡ä»¶æ‹†åˆ†æ–¹å¼ã€‚ è¿™ä¸¤ä¸ªæ¦‚å¿µå¬èµ·æ¥å¯ä»¥äº’æ¢ï¼Œä½†æ˜¾ç„¶å¹¶ä¸æ˜¯è¿™æ ·ï¼š</p>
<p><strong>Bundle splitting</strong>ï¼šåˆ›å»ºæ›´å¤šï¼Œæ›´å°çš„æ–‡ä»¶ï¼ˆä½†ä¸ç®¡æ€æ ·ï¼Œæ¯ä¸ªç½‘ç»œè¯·æ±‚ä¸­éƒ½è¦åŠ è½½å®ƒä»¬ï¼‰ï¼Œæ¥ä¼˜åŒ–ç¼“å­˜ã€‚<br>
<strong>Code splitting</strong>ï¼šåŠ¨æ€åŠ è½½ä»£ç ï¼Œç”¨æˆ·å¯ä»¥ä»…ä¸‹è½½ä»–ä»¬æ­£åœ¨æŸ¥çœ‹çš„ç½‘ç«™éƒ¨åˆ†æ‰€éœ€çš„ä»£ç ã€‚</p>
<p>ç¬¬äºŒä¸ªæ¦‚å¿µå¬èµ·æ¥æ›´åŠ å¸å¼•äººå•Šï¼Œå¯¹å§ï¼Ÿå…¶å®ï¼Œè®¸å¤šå…³äºæ­¤çš„æ–‡ç« éƒ½ä¼¼ä¹è®¤ä¸ºè¿™æ˜¯åŠ è½½ JS æ–‡ä»¶çš„å”¯ä¸€æœ‰ä»·å€¼çš„ caseã€‚</p>
<p>ä½†æ˜¯æˆ‘æ¥å‘Šè¯‰ä½ ï¼Œå¯¹äºå¤šæ•°ç«™ç‚¹æ¥è¯´ï¼Œç¬¬ä¸€ä¸ªæ‰æ˜¯æ›´æœ‰ä»·å€¼çš„æ–¹å¼ï¼Œè€Œä¸”åº”è¯¥æ˜¯ä½ å¯¹ç½‘ç«™æ‰€åšçš„é¦–è¦çš„äº‹æƒ…ã€‚</p>
<p>æˆ‘ä»¬æ¥ç€æ·±å…¥å¾€ä¸‹çœ‹ã€‚</p>
<h1 id="bundle-splitting">Bundle splitting</h1>
<p>Bundle splitting èƒŒåçš„æƒ³æ³•éå¸¸ç®€å•ã€‚ å¦‚æœä½ æœ‰ä¸€ä¸ªå·¨å¤§çš„æ–‡ä»¶ï¼Œå½“ä½ æ›´æ”¹äº†ä¸€è¡Œä»£ç ï¼Œç”¨æˆ·å¿…é¡»å†æ¬¡ä¸‹è½½æ•´ä¸ªæ–‡ä»¶ã€‚ ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å°†å…¶æ‹†åˆ†ä¸ºä¸¤ä¸ªæ–‡ä»¶ï¼Œåˆ™ç”¨æˆ·åªéœ€ä¸‹è½½å·²æ›´æ”¹çš„æ–‡ä»¶ï¼Œæµè§ˆå™¨ä¼šä»ç¼“å­˜ä¸­è¯»å–å¦ä¸€ä¸ªæ–‡ä»¶ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œç”±äº Bundle splitting æ˜¯å®Œå…¨é’ˆå¯¹ç¼“å­˜çš„ï¼Œæ‰€ä»¥å¯¹äºé¦–æ¬¡è®¿é—®çš„ç”¨æˆ·è€Œè¨€ï¼ˆæ‹†ä¸ä¸æ‹†ï¼‰æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚</p>
<p>ï¼ˆæˆ‘è®¤ä¸ºå¤ªå¤šçš„æ€§èƒ½è®¨è®ºéƒ½ä¸é¦–æ¬¡è®¿é—®ç½‘ç«™æœ‰å…³ã€‚ä¹Ÿè®¸è¿™éƒ¨åˆ†æ˜¯å› ä¸ºã€Œç¬¬ä¸€å°è±¡å¾ˆé‡è¦ã€ï¼Œå¦ä¸€å—æ˜¯å› ä¸ºå®ƒå¾ˆå®¹æ˜“é‡åŒ–ã€‚ï¼‰</p>
<p>å½“æ¶‰åŠåˆ°é¢‘ç¹è®¿é—®çš„ç”¨æˆ·æ—¶ï¼Œé‡åŒ–æ€§èƒ½ä¼˜åŒ–å¸¦æ¥çš„å½±å“å¯èƒ½å¾ˆéº»çƒ¦ï¼Œä½†æˆ‘ä»¬å¿…é¡»é‡åŒ–ï¼</p>
<p>ä¸‹é¢æ˜¯æˆ‘åœ¨å‰ä¸€æ®µä¸­æåˆ°çš„æƒ…å†µï¼š</p>
<ul>
<li>
<p>Alice æ¯å‘¨è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™ä¸€æ¬¡ï¼ŒæŒç»­10å‘¨</p>
</li>
<li>
<p>æˆ‘ä»¬æ¯å‘¨ä¸€æ¬¡å‘ç‰ˆ</p>
</li>
<li>
<p>æˆ‘ä»¬æ¯å‘¨éƒ½ä¼šæ›´æ–°ã€Œäº§å“åˆ—è¡¨ã€é¡µ</p>
</li>
<li>
<p>æˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªã€Œäº§å“è¯¦æƒ…ã€é¡µï¼Œç°åœ¨æˆ‘ä»¬å…ˆä¸ç®¡å®ƒ</p>
</li>
<li>
<p>åœ¨ç¬¬5å‘¨ï¼Œæˆ‘ä»¬å‘ç½‘ç«™æ·»åŠ ä¸€ä¸ªæ–°çš„ npm åŒ…</p>
</li>
<li>
<p>ç¬¬8å‘¨ï¼Œæˆ‘ä»¬æ›´æ–°äº†å…¶ä¸­ä¸€ä¸ªæ—¢æœ‰çš„ npm åŒ…</p>
</li>
</ul>
<p>ä¸€äº›äººï¼ˆæ¯”å¦‚æˆ‘ï¼‰å¸Œæœ›è¿™ç§æƒ…å†µå°½å¯èƒ½ç¬¦åˆå®é™…ã€‚ è¿™ç§åšæ³•å¹¶ä¸å¥½ã€‚å®é™…æƒ…å†µå¹¶ä¸é‡è¦ï¼Œæˆ‘ä»¬ä¹‹åä¼šæ‰¾å‡ºåŸå› ã€‚ ï¼ˆå…ˆç•™ä¸ªé“ºå«ï¼ï¼‰</p>
<h1 id="æ¯”è¾ƒåŸºå‡†å€¼">æ¯”è¾ƒåŸºå‡†å€¼</h1>
<p>å‡è®¾æˆ‘ä»¬çš„ JavaScript åŒ…æ€»å¤§å°ä¸º 400 KBï¼Œç›®å‰ä»¥å•ä¸ªæ–‡ä»¶<code>main.js</code>çš„å½¢å¼åŠ è½½ã€‚</p>
<p>æˆ‘ä»¬çš„ Webpack config çœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆçœç•¥äº†æ— å…³çš„é…ç½®å†…å®¹ï¼‰ï¼š</p>
<pre><code class="language-javascript">const path = require('path');

module.exports = {
  entry: path.resolve(__dirname, 'src/index.js'),
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: '[name].[contenthash].js',
  },
};
</code></pre>
<div align=center style="margin: 0; padding: 0; margin-bottom: 30px; color: grey; ">å½“åªæœ‰ä¸€ä¸ªå…¥å£æ—¶ï¼ŒWebpack ä¼šå°†æ‰“åŒ…ç»“æœ bundle å‘½åä¸ºã€Œmain.jsã€</div>
<p>ï¼ˆå¯¹äºé‚£äº›åˆšå¼€å§‹å­¦ä¹ ç¼“å­˜æ›´æ–°ç­–ç•¥çš„äººï¼šæ¯å½“æˆ‘æåˆ°<code>main.js</code>æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨è¯´<code>main.xMePWxHo.js</code>ä¹‹ç±»çš„ä¸œè¥¿ï¼Œè¿™ä¸€å¨ç–¯ç‹‚çš„å­—æ¯ä¸²æ˜¯æ–‡ä»¶å†…å®¹çš„å“ˆå¸Œã€‚è¿™æ„å‘³ç€å½“ç¨‹åºä¸­ä»£ç æ›´æ”¹æ—¶ä¼šäº§ç”Ÿä¸åŒçš„æ–‡ä»¶å ï¼Œä»è€Œè¿«ä½¿æµè§ˆå™¨ä¸‹è½½æ–°æ–‡ä»¶ã€‚ï¼‰</p>
<p>æ¯å‘¨æˆ‘ä»¬ä¼šå¯¹ç½‘ç«™è¿›è¡Œä¸€äº›æ–°æ›´æ”¹ï¼ŒåŒ…ä¸­å†…å®¹å“ˆå¸Œéƒ½ä¼šæ›´æ”¹ã€‚ æ‰€ä»¥ï¼Œåœ¨æ¯å‘¨ Alice è®¿é—®æˆ‘ä»¬çš„ç½‘ç«™æ—¶ï¼Œéƒ½å¿…é¡»è¦ä¸‹è½½ä¸€ä¸ªæ–°çš„400 KBæ–‡ä»¶ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬è¦åšä¸€ä¸ªèŠ±é‡Œèƒ¡å“¨çš„è¡¨ï¼Œå®ƒçœ‹èµ·æ¥å°±åƒè¿™æ ·ã€‚</p>
<figure data-type="image" tabindex="1"><img src="https://CallanBi.github.io/post-images/1620541076491.png" alt="" loading="lazy"></figure>
<div align=center style="margin: 0; padding: 0; margin-bottom: 30px; color: grey; ">ä¸–ç•Œä¸Šæœ€æ²¡ç”¨çš„ Total ç»Ÿè®¡</div>
<p>è¿™10å‘¨ç§¯èµ·æ¥ï¼Œ<strong>å°±æ˜¯ 4.12 MB</strong>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åšå¾—æ›´å¥½ã€‚</p>
<h2 id="æ‹†åˆ†å‡º-vendor-åŒ…">æ‹†åˆ†å‡º vendor åŒ…</h2>
<p>è®©æˆ‘ä»¬æŠŠåŒ…æ‹†æˆ<code>main.js</code>å’Œ<code>vendor.js</code>ã€‚</p>
<p>å¾ˆç®€å•ï¼Œç±»ä¼¼äºï¼š</p>
<pre><code class="language-javascript">
const path = require('path');

module.exports = {
  entry: path.resolve(__dirname, 'src/index.js'),
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: '[name].[contenthash].js',
  },
  optimization: {
    splitChunks: {
      chunks: 'all',
    },
  },
};
</code></pre>
<p>Webpack 4 å°½åŠ›ä¸ºä½ åšåˆ°äº†æœ€å¥½ï¼Œä½ ä¸å¿…å‘Šè¯‰å®ƒä½ æ€ä¹ˆæ‹†åˆ†ä½ çš„ bundleã€‚</p>
<p>è¿™ä¼šå¯¼è‡´ä¸€äº›è¯æœ¯æ¯”å¦‚ï¼šã€Œå“¦ğŸ‚ğŸºï¼ŒWebpackæ•´æŒºå¥½ï¼ã€</p>
<p>è¿˜æœ‰è®¸å¤šç±»ä¼¼äºã€Œä½ tmåˆ°åº•å¯¹æˆ‘çš„ bundle åšäº†ä»€ä¹ˆï¼Ÿï¼ã€çš„ç–‘é—®ã€‚</p>
<p>é“›é“›ï¼åŠ ä¸Š<code>optimization.splitChunks.chunks = 'all'</code>æ˜¯ä¸€ç§ã€ŒæŠŠæ‰€æœ‰ <code>node_modules</code>é‡Œçš„ä¸œè¥¿æ ‹æ”¾åˆ°ä¸€ä¸ªå«<code>vendors~main.js</code>çš„æ–‡ä»¶ã€çš„è¯´æ³•ã€‚</p>
<p>æœ‰äº†è¿™ä¸ªåŸºæœ¬çš„ bundle splitting ä¹‹åï¼ŒAlice è¿˜ä¼šåœ¨æ¯æ¬¡è®¿é—®æ—¶ä¸‹è½½ä¸€ä¸ªæ–°çš„200 KBçš„ main.jsï¼Œä½†åªä¼šåœ¨ç¬¬ä¸€å‘¨ï¼Œç¬¬å…«å‘¨å’Œç¬¬äº”å‘¨ä¸‹è½½è¿™ä¸ª 200 KB çš„ <code>vendor.js</code>ã€‚<br>
<img src="https://CallanBi.github.io/post-images/1620542292178.png" alt="" loading="lazy"></p>
<div align=center style="margin: 0; padding: 0; margin-bottom: 30px; color: grey; ">å·§äº†ï¼Œè¿™ä¸¤ä¸ª bundle çš„å¤§å°æ°å¥½æ˜¯200 KBã€‚</div>
<p><strong>æ€»å…± 2.64 MBã€‚</strong></p>
<p>å‡å°‘36ï¼…ï¼Œé…ç½®ä¸­æ·»åŠ äº†äº”è¡Œä»£ç ï¼Œè¿˜ä¸èµ–ã€‚ åœ¨ç»§ç»­è¯»è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œç°åœ¨å°±å»å®è·µä¸‹ã€‚ å¦‚æœéœ€è¦ä»Webpack 3 å‡çº§åˆ°4ï¼Œä¸è¦æ‹…å¿ƒï¼Œå®ƒéå¸¸æ— ç—›ï¼ˆè€Œä¸”å…è´¹ï¼ï¼‰ã€‚</p>
<p>æˆ‘è§‰å¾—è¿™ç§æ€§èƒ½æå‡å¯èƒ½ä¼šæ›´æŠ½è±¡ï¼Œå› ä¸ºåˆ†æ•£åœ¨åä¸ªæ˜ŸæœŸï¼Œä½†å…¶å®äº¤ä»˜ç»™å¿ å®ç”¨æˆ·çš„å­—èŠ‚æ•°å‡å°‘äº†36ï¼…ï¼Œæˆ‘ä»¬åº”è¯¥ä¸ºè‡ªå·±æ„Ÿåˆ°è‡ªè±ªã€‚</p>
<p>ä½†æˆ‘ä»¬è¿˜å¯ä»¥åšå¾—æ›´å¥½ã€‚</p>
<h2 id="æŠŠæ¯ä¸ª-npm-åŒ…éƒ½æ‹†å‡ºæ¥">æŠŠæ¯ä¸ª npm åŒ…éƒ½æ‹†å‡ºæ¥</h2>
<p>æˆ‘ä»¬çš„<code>vendor.js</code>é‡åˆ°äº†ä¸åŸæ¥<code>main.js</code>æ–‡ä»¶ç›¸åŒçš„é—®é¢˜â€”â€”å¯¹å…¶ä¸­ä¸€éƒ¨åˆ†è¿›è¡Œæ›´æ”¹æ„å‘³ç€éœ€è¦é‡æ–°ä¸‹è½½å®ƒçš„å…¨éƒ¨ã€‚</p>
<p>æ‰€ä»¥ä¸ºä»€ä¹ˆä¸ä¸ºæ¯ä¸ªnpmåŒ…å•ç‹¬å‡†å¤‡ä¸€ä¸ªæ–‡ä»¶å‘¢ï¼Ÿ è¿™å¾ˆå®¹æ˜“åšåˆ°ã€‚</p>
<p>é‚£è®©æˆ‘ä»¬å°†<code>react</code>ï¼Œ<code>lodash</code>ï¼Œ<code>redux</code>ï¼Œ<code>moment</code>ç­‰åˆ†æˆä¸åŒçš„æ–‡ä»¶ï¼š</p>
<pre><code class="language-javascript">const path = require('path');
const webpack = require('webpack');

module.exports = {
  entry: path.resolve(__dirname, 'src/index.js'),
  plugins: [
    new webpack.HashedModuleIdsPlugin(), // ç¡®ä¿ hash ä¸è¢«æ„å¤–æ”¹å˜
  ],
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: '[name].[contenthash].js',
  },
  optimization: {
    runtimeChunk: 'single',
    splitChunks: {
      chunks: 'all',
      maxInitialRequests: Infinity,
      minSize: 0,
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name(module) {
            //å–å¾—åç§°ã€‚ä¾‹å¦‚ /node_modules/packageName/not/this/part.js
            // æˆ– /node_modules/packageName
            const packageName = module.context.match(/[\\/]node_modules[\\/](.*?)([\\/]|$)/)[1];

            // npm package æ˜¯ URL å®‰å…¨çš„ï¼Œä½†æœ‰äº›æœåŠ¡ä¸å–œæ¬¢ @ ç¬¦å·
            return `npm.${packageName.replace('@', '')}`;
          },
        },
      },
    },
  },
};
</code></pre>
<p><a href="https://webpack.js.org/guides/caching/">è¿™ç¯‡æ–‡æ¡£</a> ä¼šå¾ˆå¥½åœ°è¯´æ˜è¿™é‡Œçš„å¤§å¤šæ•°å†…å®¹ï¼Œä½†æ˜¯æˆ‘è¦å‘ä½ è§£é‡Šä¸€äº›æœ‰è¶£çš„éƒ¨åˆ†ï¼Œå› ä¸ºå®ƒä»¬èŠ±äº†æˆ‘å·¨é•¿çš„æ—¶é—´æ‰å¼„å¯¹ã€‚</p>
<ul>
<li>
<p>Webpack æ‹¥æœ‰ä¸€äº›èªæ˜ä½†å®é™…ä¸Šæœ‰ç‚¹å‚»çš„é»˜è®¤é…ç½®ï¼Œåƒï¼šåˆ†å‰²è¾“å‡ºæ–‡ä»¶æ—¶æœ€å¤šå¯ä»¥åŒ…å«3ä¸ªæ–‡ä»¶ï¼Œæœ€å°æ–‡ä»¶å¤§å°ä¸º30 KBï¼ˆå³æ¯”è¿™å°çš„æ–‡ä»¶éƒ½å¯ä»¥åˆå¹¶åœ¨ä¸€èµ·ï¼‰ã€‚ æ‰€ä»¥æˆ‘è¦†ç›–äº†è¿™äº›é…ç½®ã€‚</p>
</li>
<li>
<p><code>cacheGroups</code>æ˜¯æˆ‘ä»¬å®šä¹‰ Webpack å¦‚ä½•å°† chunks åˆ°è¾“å‡ºåˆ° bundle çš„è§„åˆ™ã€‚ è¿™é‡Œæœ‰ä¸€ä¸ªå«åšã€Œvendorã€çš„ï¼Œä»»ä½•<code>node_modules</code>çš„åŒ…éƒ½åœ¨è¿™é‡Œã€‚ é€šå¸¸ï¼Œä½ åªéœ€å°†è¾“å‡ºæ–‡ä»¶çš„åç§°å®šä¹‰ä¸ºå­—ç¬¦ä¸²ã€‚ ä½†æ˜¯æˆ‘å°†<code>name</code>å®šä¹‰ä¸ºä¸€ä¸ªå‡½æ•°ï¼ˆå°†ä¸ºæ¯ä¸ªå·²è§£æçš„æ–‡ä»¶è°ƒç”¨è¯¥å‡½æ•°ï¼‰ï¼Œä»æ¨¡å—è·¯å¾„è¿”å›åŒ…çš„åç§°ã€‚ ç»“æœæ˜¯ï¼Œæ¯ä¸ªåŒ…éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯”å¦‚ <code>npm.react-dom.899sadfhj4.js</code>ã€‚</p>
</li>
<li>
<p>å‘åŒ…æ—¶<a href="https://docs.npmjs.com/cli/v7/configuring-npm/package-json">åŒ…åç§°å¿…é¡»æ˜¯ URLå®‰å…¨çš„</a>ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸å¿…ç”¨<code>encodeURI</code> å¤„ç† <code>packageName</code> ã€‚ä½†æ˜¯ï¼Œæˆ‘å‘ç° .NETæœåŠ¡æ— æ³•æä¾›åç§°ä¸­å¸¦æœ‰@çš„æ–‡ä»¶ï¼ˆæ¥è‡ªèŒƒå›´é™å®šçš„åŒ…ï¼‰ï¼Œæ‰€ä»¥æˆ‘åœ¨æ­¤ä»£ç æ®µä¸­æ›¿æ¢äº†è¯¥å‘½åã€‚</p>
</li>
<li>
<p>æ•´ä¸ªé…ç½®å¾ˆæ£’ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€åŠ³æ°¸é€¸çš„ã€‚ å®ƒæ— éœ€ç»´æŠ¤â€”â€”æˆ‘ä¸éœ€è¦æŒ‰åç§°å¼•ç”¨ä»»ä½•åŒ…ã€‚</p>
</li>
</ul>
<p>è¿™æ—¶ï¼ŒAlice ä»æ¯å‘¨é‡æ–°åŠ è½½æˆ‘ä»¬200 KBçš„<code>main.js</code>æ–‡ä»¶ï¼›åœ¨é¦–æ¬¡è®¿é—®æ—¶ä»å°†ä¸‹è½½200 KBçš„ npm åŒ…ï¼Œä½†å¥¹æ°¸è¿œä¸ä¼šå†æ¬¡ä¸‹è½½ç›¸åŒçš„åŒ…ã€‚<br>
<img src="https://CallanBi.github.io/post-images/1620544773524.png" alt="" loading="lazy"></p>
<div align=center style="margin: 0; padding: 0; margin-bottom: 30px; color: grey; ">çªç„¶å‘ç°æ¯ä¸ª npm åŒ…éƒ½æ°å¥½æ˜¯20 KBã€‚ ä¸–æ‰€ç½•è§ï¼</div>
<p><strong>è¿™æ˜¯2.24MBã€‚</strong></p>
<p>ä¸æ¯”è¾ƒåŸºå‡†å€¼ç›¸æ¯”å‡å°‘äº†44ï¼…ï¼Œä»…ä»…ä»åšå®¢æ–‡ç« ä¸­ copy/plate äº†æŸäº›ä»£ç çš„ä½ æ¥è¯´ï¼Œè¿™éå¸¸é…·ã€‚</p>
<p>æˆ‘åœ¨æƒ³ä¼šä¸ä¼šæœ‰å¯èƒ½è¶…è¿‡50ï¼…ï¼Ÿ</p>
<p>é‚£ä¸æ˜¯ç›–äº†å¸½äº†å—ã€‚</p>
<h2 id="æ‹†åˆ†åº”ç”¨çš„ä»£ç åŒºåŸŸ">æ‹†åˆ†åº”ç”¨çš„ä»£ç åŒºåŸŸ</h2>
<p>è®©æˆ‘ä»¬å…³æ³¨ä¸‹å¯æ€œçš„ Alice ä¸€æ¬¡åˆä¸€æ¬¡ï¼ˆç”šè‡³å†ä¸€æ¬¡ï¼‰ä¸‹è½½çš„<code>main.js</code>æ–‡ä»¶ã€‚</p>
<p>å‰é¢æˆ‘æåˆ°è¿‡ï¼Œæˆ‘ä»¬åœ¨æ­¤ç«™ç‚¹ä¸Šæœ‰ä¸¤ä¸ªæˆªç„¶ä¸åŒçš„éƒ¨åˆ†ï¼šä¸€ä¸ªäº§å“åˆ—è¡¨å’Œä¸€ä¸ªäº§å“è¯¦æƒ…é¡µã€‚ è¿™äº›åŒºåŸŸä¸­æ¯ä¸ªåŒºåŸŸçš„è‡ªèº«çš„ä»£ç ä¸º 25 KBï¼ˆä¿ç•™150 KBçš„å…±äº«ä»£ç ï¼‰ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬çš„â€œäº§å“è¯¦æƒ…â€é¡µé¢å˜åŒ–ä¸å¤§ï¼Œå› ä¸ºæˆ‘ä»¬åšå¾—å¦‚æ­¤å®Œç¾ã€‚ å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬å°†å…¶åˆ†æˆå•ç‹¬çš„æ–‡ä»¶ï¼Œåˆ™å¤§å¤šæ•°æ—¶å€™éƒ½å¯ä»¥ä»ç¼“å­˜ä¸­æä¾›ã€‚</p>
<p>å¯¹æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥æäº›äº‹æƒ…ã€‚</p>
<p>æˆ‘ä»¬æ‰‹åŠ¨åœ°æ·»åŠ ä¸€äº›å…¥å£ç‚¹ï¼Œå‘Šè¯‰ Webpack ä¸ºå…¶ä¸­çš„æ¯é¡¹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ã€‚</p>
<pre><code class="language-javascript">module.exports = {
  entry: {
    main: path.resolve(__dirname, 'src/index.js'),
    ProductList: path.resolve(__dirname, 'src/ProductList/ProductList.js'),
    ProductPage: path.resolve(__dirname, 'src/ProductPage/ProductPage.js'),
    Icon: path.resolve(__dirname, 'src/Icon/Icon.js'),
  },
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: '[name].[contenthash:8].js',
  },
  plugins: [
    new webpack.HashedModuleIdsPlugin(), // ç¡®ä¿ hash ä¸è¢«æ„å¤–æ”¹å˜
  ],
  optimization: {
    runtimeChunk: 'single',
    splitChunks: {
      chunks: 'all',
      maxInitialRequests: Infinity,
      minSize: 0,
      cacheGroups: {
        vendor: {
          test: /[\\/]node_modules[\\/]/,
          name(module) {
            //å–å¾—åç§°ã€‚ä¾‹å¦‚ /node_modules/packageName/not/this/part.js
            // æˆ– /node_modules/packageName
            const packageName = module.context.match(/[\\/]node_modules[\\/](.*?)([\\/]|$)/)[1];

            // npm package æ˜¯ URL å®‰å…¨çš„ï¼Œä½†æœ‰äº›æœåŠ¡ä¸å–œæ¬¢ @ ç¬¦å·
            return `npm.${packageName.replace('@', '')}`;
          },
        },
      },
    },
  },
};
</code></pre>
<p>é è°±çš„ Webpackè¿˜ä¼šä¸ºåœ¨ ProductList å’Œ ProductPage ä¹‹é—´å…±äº«çš„å†…å®¹åˆ›å»ºæ–‡ä»¶ï¼Œä½¿å¾—æˆ‘ä»¬ä¸ä¼šå¾—åˆ°é‡å¤çš„ä»£ç ã€‚</p>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™å°†ä¸ºäº²çˆ±çš„ Alice çœä¸‹é¢å¤–çš„50 KBä¸‹è½½é‡ã€‚<br>
<img src="https://CallanBi.github.io/post-images/1620545771325.png" alt="" loading="lazy"></p>
<div align=center style="margin: 0; padding: 0; margin-bottom: 30px; color: grey; ">æˆ‘ä»¬åœ¨ç¬¬6å‘¨è°ƒæ•´äº† iconï¼Œæˆ‘ååˆ†ç¡®å®šä½ è¿˜è®°å¾—</div>
<p><strong>è¿™äº›ä»…ä»…1.815 MBï¼</strong></p>
<p>æˆ‘ä»¬å·²ç»ä¸º Alice èŠ‚çœäº†é«˜è¾¾56ï¼…çš„ä¸‹è½½é‡ï¼Œå¹¶ä¸”è¿™ç§èŠ‚çœå°†ï¼ˆåœ¨æˆ‘ä»¬çš„ç†è®ºåœºæ™¯ä¸­ï¼‰ä¸€ç›´æŒç»­åˆ°æ—¶é—´å°½å¤´ã€‚</p>
<p>æˆ‘ä¹‹å‰æåˆ°è¿‡ï¼Œåœ¨æµ‹è¯•ä¹‹ä¸‹çš„å®é™…æƒ…å†µå¹¶ä¸é‡è¦ã€‚ è¿™æ˜¯å› ä¸ºï¼Œæ— è®ºä½ é‡åˆ°ä»€ä¹ˆæƒ…å†µï¼Œç»“è®ºéƒ½æ˜¯ç›¸åŒçš„ï¼šå°†ä½ çš„åº”ç”¨æ‹†åˆ†ä¸ºåˆç†çš„å°æ–‡ä»¶ï¼Œä½ çš„çš„ç”¨æˆ·å°±ä¼šä¸‹è½½æ›´å°‘çš„ä»£ç ã€‚</p>
<hr />
<p>å¾ˆå¿«ï¼Œæˆ‘å°†è¦è®¨è®ºã€Œcode splittingã€â€”â€”å¦ä¸€ç§ç±»å‹çš„æ–‡ä»¶æ‹†è§£â€”â€”ä½†é¦–å…ˆï¼Œæˆ‘æƒ³è§£å†³ä½ ç°åœ¨åœ¨æƒ³çš„ä¸‰ä¸ªç–‘æƒ‘ç‚¹ã€‚</p>
<h3 id="1æœ‰å¾ˆå¤šç½‘ç»œè¯·æ±‚ä¼šä¸ä¼šå¾ˆæ…¢">#1ï¼šæœ‰å¾ˆå¤šç½‘ç»œè¯·æ±‚ä¼šä¸ä¼šå¾ˆæ…¢ï¼Ÿ</h3>
<p>ç­”æ¡ˆæ˜¯å¾ˆå¤§å£°çš„â€œä¸â€ã€‚</p>
<p>åœ¨ HTTP/1.1 æ—¶ä»£æ›¾ç»æ˜¯è¿™ç§æƒ…å†µï¼Œä½†æ˜¯åœ¨ HTTP/2 ä¸­å´ä¸æ˜¯è¿™ç§æƒ…å†µã€‚</p>
<p>å°½ç®¡ï¼Œ<a href="https://medium.com/@asyncmax/the-right-way-to-bundle-your-assets-for-faster-sites-over-http-2-437c37efe3ff">è¿™ç¯‡2016å¹´çš„æ–‡ç« </a>å’Œ<a href="http://engineering.khanacademy.org/posts/js-packaging-http2.htm">Khan Academy 2015å¹´çš„å¸–å­</a>éƒ½å¾—å‡ºäº†è¿™æ ·çš„ç»“è®ºï¼šå³ä½¿ä½¿ç”¨HTTP/2ï¼Œä¸‹è½½å¤ªå¤šæ–‡ä»¶çš„é€Ÿåº¦ä»ç„¶è¾ƒæ…¢ã€‚ ä½†åœ¨è¿™ä¸¤ä¸ªå¸–å­ä¸­ï¼Œã€Œå¤ªå¤šã€æ–‡ä»¶æ„å‘³ç€ã€Œå‡ ç™¾ã€ã€‚ å› æ­¤ï¼Œè¯·è®°ä½ï¼Œå¦‚æœä½ æœ‰æ•°ç™¾ä¸ªæ–‡ä»¶ï¼Œæ‰å¯èƒ½ä¼šè¾¾åˆ°å¹¶å‘é™åˆ¶ã€‚</p>
<p>æˆ–è€…ä½ æƒ³çŸ¥é“è¿½æº¯åˆ° Windows 10ä¸Šçš„ IE11 å¯¹ HTTP/2 çš„æ”¯æŒã€‚æˆ‘å¯¹ä½¿ç”¨æ¯”è¿™æ›´æ—©ç‰ˆæœ¬çš„ç¯å¢ƒçš„äººè¿›è¡Œäº†è¯¦å°½çš„è°ƒæŸ¥ï¼Œä»–ä»¬ä¸€è‡´å‘æˆ‘ä¿è¯ï¼Œä»–ä»¬ä¸åœ¨ä¹ç½‘ç«™åŠ è½½çš„é€Ÿåº¦å¦‚ä½•ã€‚</p>
<h3 id="2ä¼šä¸ä¼š-æ¯ä¸ªwebpack-bundle-ä¸­éƒ½æœ‰å¼€é”€æ ·æ¿ä»£ç ">#2ï¼šä¼šä¸ä¼š æ¯ä¸ªWebpack bundle ä¸­éƒ½æœ‰å¼€é”€/æ ·æ¿ä»£ç ï¼Ÿ</h3>
<p>ç¡®å®ã€‚</p>
<h3 id="3ä¼šä¸ä¼šå› ä¸ºæ‹¥æœ‰å¤šä¸ªå°æ–‡ä»¶è€Œä¸§å¤±äº†å‹ç¼©æ–¹é¢çš„ä¼˜åŠ¿">#3ï¼šä¼šä¸ä¼šå› ä¸ºæ‹¥æœ‰å¤šä¸ªå°æ–‡ä»¶è€Œä¸§å¤±äº†å‹ç¼©æ–¹é¢ï¼ˆçš„ä¼˜åŠ¿ï¼‰ï¼Ÿ</h3>
<p>å¯¹ï¼Œä¹Ÿç¡®å®ä¼šã€‚</p>
<p>å‘ƒï¼Œç³Ÿäº†ï¼š</p>
<ul>
<li>
<p>æ›´å¤šçš„æ–‡ä»¶ = æ›´å¤š Webpack æ ·æ¿ä»£ç </p>
</li>
<li>
<p>æ›´å¤šçš„æ–‡ä»¶ = æ›´å°‘çš„å‹ç¼©</p>
</li>
</ul>
<p>è®©æˆ‘ä»¬å¯¹å®ƒæ¥ä¸€ä¸ªé‡åŒ–ï¼Œä½¿å¾—æˆ‘ä»¬ç¡®åˆ‡çŸ¥é“éœ€è¦æ‹…å¿ƒçš„ç¨‹åº¦ã€‚</p>
<p>â€¦â€¦</p>
<p>OKï¼Œæˆ‘åˆšåšäº†ä¸€ä¸ªæµ‹è¯•ï¼Œä¸€ä¸ª190 KBçš„ç«™ç‚¹åˆ†ä¸º19ä¸ªæ–‡ä»¶ï¼Œæ·»åŠ åˆ°å‘é€ç»™æµè§ˆå™¨çš„æ€»å­—èŠ‚æ•°ä¸­å¤§çº¦å¢åŠ äº†2ï¼…ã€‚</p>
<p>æ‰€ä»¥â€¦â€¦å¯¹äºç¬¬ä¸€æ¬¡è®¿é—®æœ‰2%çš„å¢é‡ï¼Œä¸æ­¤åŒæ—¶åœ¨ä¹‹åçš„è®¿é—®æœ‰ 60% å‡å°‘é‡ï¼Œç›´åˆ°å®‡å®™çš„å°½å¤´ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬æ‰€éœ€è¦æ‹…å¿ƒçš„ç¨‹åº¦æ­£ç¡®çš„æ˜¯ï¼šå®Œå…¨æ²¡æœ‰ã€‚</p>
<p>åœ¨æµ‹è¯• 1 vs 19 ä¸ªæ–‡ä»¶æ—¶ï¼Œæˆ‘åœ¨æƒ³æˆ‘å¯ä»¥åœ¨ä¸€äº›ä¸åŒçš„ç½‘ç»œä¸Šä½¿ç”¨å®ƒï¼ŒåŒ…æ‹¬HTTP/1.1ã€‚</p>
<p>ç„¶åä¸‹é¢æ˜¯æˆ‘æçš„è¡¨æ ¼ï¼Œå¼ºåŠ›æ”¯æ’‘äº†â€œæ–‡ä»¶è¶Šå¤šè¶Šå¥½â€çš„æƒ³æ³•ï¼š</p>
<figure data-type="image" tabindex="2"><img src="https://CallanBi.github.io/post-images/1620547675439.png" alt="" loading="lazy"></figure>
<div align=center style="margin: 0; padding: 0; margin-bottom: 30px; color: grey; ">ï¼ˆä»Firebaseé™æ€ä¸»æœº)åŠ è½½çš„åŒä¸€190 KBç½‘ç«™ï¼‰</div>
<p>åœ¨ 3G å’Œ 4G ä¸Šï¼Œå½“æœ‰ 19 ä¸ªæ–‡ä»¶æ—¶ï¼Œæ­¤ç«™ç‚¹çš„åŠ è½½æ—¶é—´å‡å°‘äº† 30ï¼…ã€‚</p>
<p>çœŸçš„å¦‚æ­¤å—ï¼Ÿ</p>
<p>è¿™æ˜¯å™ªç‚¹éå¸¸å¤šçš„æ•°æ®ã€‚ ä¾‹å¦‚ï¼Œåœ¨ Run 2 çš„ 4G ç½‘ç»œä¸Šï¼Œç«™ç‚¹åŠ è½½äº†646æ¯«ç§’ï¼Œç„¶åä¸¤æ¬¡è¿è¡Œåˆ™èŠ±è´¹äº† 1116æ¯«ç§’â€”â€”åœ¨ä»€ä¹ˆéƒ½æ²¡åšçš„æƒ…å†µä¸‹é•¿äº†73ï¼…ã€‚ å› æ­¤ï¼Œå®£ç§° HTTP/2 çš„é€Ÿåº¦æé«˜äº†30ï¼…ä¼¼ä¹æœ‰ç‚¹ç‹¡çŒ¾ã€‚</p>
<p>ï¼ˆå³å°†æ¨å‡ºï¼šä¸€ç§è‡ªå®šä¹‰å›¾è¡¨ç±»å‹ï¼Œæ—¨åœ¨å¯è§†åŒ–é¡µé¢åŠ è½½æ—¶é—´çš„å·®å¼‚ã€‚ï¼‰</p>
<p>æˆ‘å»ºäº†è¿™å¼ è¡¨ï¼Œå°è¯•é‡åŒ– HTTP/2 çš„åŒºåˆ«ï¼Œä½†äº‹å®ä¸Šæˆ‘èƒ½å”¯ä¸€èƒ½è¯´çš„æ˜¯â€œå¯èƒ½æ²¡æœ‰å¤šå¤§åŒºåˆ«â€ã€‚</p>
<p>çœŸæ­£å¥‡æ€ªæ˜¯æœ€åä¸¤æ’ã€‚ é‚£æ˜¯æ—§çš„ Windows å’Œ HTTP/1.1ï¼Œæˆ‘æ‰“èµŒé€Ÿåº¦ä¼šæ…¢å¾ˆå¤šï¼Œä½†å¹¶éå¦‚æ­¤ã€‚æˆ‘æƒ³æˆ‘éœ€æ›´æ…¢çš„ç½‘ç»œã€‚</p>
<hr />
<p>è®²æ•…äº‹çš„æ—¶é—´åˆ°äº†ï¼ æˆ‘ä»<a href="https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/">å¾®è½¯å®˜ç½‘ä¸‹è½½äº†Windows 7è™šæ‹Ÿæœº</a>æ¥æµ‹è¯•è¿™äº›å†…å®¹ã€‚</p>
<p>å®ƒé™„å¸¦äº†IE8ï¼Œä½†æˆ‘å‡çº§åˆ°IE9ã€‚</p>
<p>æ‰€ä»¥æˆ‘è½¬åˆ°äº†å¾®è½¯çš„IE9ä¸‹è½½é¡µé¢ï¼Œç„¶åâ€¦â€¦<br>
<img src="https://CallanBi.github.io/post-images/1620548267039.png" alt="" loading="lazy"></p>
<div align=center style="margin: 0; padding: 0; margin-bottom: 30px; color: grey; ">æˆ‘å¤©ã€‚ä½ åœ¨é€—æˆ‘ï¼Ÿè¿™è¿˜æœ‰ä»€ä¹ˆå¥½è¯´å“’</div>
<p>æœ€åå…³äº HTTP/2 çš„æœ€åä¸€å¥è¯ã€‚ä½ çŸ¥é“å®ƒç°åœ¨å·²ç»é›†æˆåˆ° Node ä¸­äº†å—ï¼Ÿ å¦‚æœä½ æƒ³ç©ä¸€ä¸‹ï¼Œæˆ‘ç¼–å†™äº†ä¸€ä¸ªå¸¦æœ‰ gzipï¼Œbrotli å’Œå“åº”ç¼“å­˜çš„<a href="https://gist.github.com/davidgilbertson/e5690c04e06c4882cf5761f8acff36ec">100è¡ŒHTTP/2 æœåŠ¡å™¨</a>ï¼Œå¸¦æ¥ğŸš¢æ–°çš„æµ‹è¯•ä¹è¶£ã€‚</p>
<hr />
<p>å…³äº bundle splitting çš„ä¸€åˆ‡å°±è®²å®Œäº†ã€‚ æˆ‘è§‰å¾—è¿™ç§æ–¹æ³•çš„å”¯ä¸€ç¼ºç‚¹å°±æ˜¯å¿…é¡»ä¸æ–­è¯´æœäººä»¬ç›¸ä¿¡åŠ è½½è®¸å¤šå°æ–‡ä»¶æ˜¯OKçš„ã€‚</p>
<hr />
<h1 id="code-splittingåˆ«åŠ è½½ä½ ä¸éœ€è¦çš„ä»£ç ">Code splittingï¼ˆåˆ«åŠ è½½ä½ ä¸éœ€è¦çš„ä»£ç ï¼‰</h1>
<p>è¿™ç§ç‰¹åˆ«çš„æ–¹æ³•åªæœ‰åœ¨æŸäº›ç«™ç‚¹ä¸Šæ‰æœ‰æ„ä¹‰ï¼Œæ¯”å¦‚æˆ‘çš„ã€‚</p>
<p>æˆ‘æƒ³åº”ç”¨æˆ‘åˆšæƒ³å‡ºæ¥çš„ 20/20 è§„åˆ™ï¼šå¦‚æœä½ çš„ç½‘ç«™çš„æŸä¸ªéƒ¨åˆ†åªæœ‰20ï¼…çš„ç”¨æˆ·è®¿é—®è¿‡ï¼Œå¹¶ä¸”è¿™ä¸ªéƒ¨åˆ†å¤§è¿‡ä½ ç«™ç‚¹ JavaScript çš„20ï¼…ï¼Œé‚£ä¹ˆä½ åªéœ€è¦æŒ‰éœ€åŠ è½½ä»£ç ã€‚</p>
<p>è¯•ç€è°ƒæ•´è¿™äº›æ•°å­—ï¼Œæ˜¾ç„¶ï¼Œè¿˜æœ‰æ¯”è¿™æ›´å¤æ‚çš„æƒ…å†µã€‚ å…³é”®æ˜¯è¦æœ‰ä¸€ä¸ªé˜ˆå€¼ï¼Œå¯ä»¥ç¡®å®š code splitting å¯¹äºä½ çš„ç½‘ç«™åˆ°åº•åˆä¸åˆç†ã€‚</p>
<h2 id="æ€ä¹ˆç¡®å®š">æ€ä¹ˆç¡®å®šï¼Ÿ</h2>
<p>æ¯”å¦‚ä½ æœ‰ä¸€ä¸ªè´­ç‰©ç½‘ç«™ï¼Œå¹¶ä¸”æƒ³çŸ¥é“æ˜¯å¦åº”è¯¥å°†ã€Œæ”¯ä»˜ã€ä»£ç åˆ†å¼€ï¼Œå› ä¸ºåªæœ‰30ï¼…çš„ç”¨æˆ·å¯ä»¥èµ°åˆ°æ”¯ä»˜æµç¨‹ã€‚</p>
<p><mark>ä½ éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å–è´¨é‡æ›´å¥½çš„ä¸œè¥¿ã€‚</mark></p>
<p>ç¬¬äºŒä»¶äº‹ï¼Œæ˜¯è®¡ç®—å‡ºè¿™å—å®Œå…¨å”¯ä¸€çš„ä»£ç é‡ã€‚ ç”±äºä½ åœ¨æ‰§è¡Œã€Œcode splittingã€ä¹‹å‰åº”è¯¥å§‹ç»ˆè¿›è¡Œã€Œbundle splittingã€ï¼Œæ‰€ä»¥ä½ å¯èƒ½å·²ç»çŸ¥é“è¿™éƒ¨åˆ†ä»£ç æœ‰å¤šå°‘ã€‚</p>
<p>ï¼ˆå®ƒå¯èƒ½æ¯”ä½ æƒ³è±¡çš„è¦å°ï¼Œæ‰€ä»¥åœ¨ä½ è·ƒè·ƒæ¬²è¯•ä¹‹å‰å…ˆæŠŠä»£ç é‡ç´¯åŠ ä¸€ä¸‹ã€‚æ¯”å¦‚ä½ æœ‰ä¸€ä¸ª React ç«™ç‚¹ï¼Œé‚£ä¹ˆä½ çš„ storeï¼Œreduceï¼Œè·¯ç”±ï¼Œactions ç­‰éƒ½å°†åœ¨æ•´ä¸ªç«™ç‚¹ä¸Šå…±äº«ã€‚ å®Œå…¨å”¯ä¸€çš„éƒ¨åˆ†ä¸»è¦æ˜¯ä¸€äº›ç»„ä»¶å’Œä»–ä»¬çš„å·¥å…·ã€‚ï¼‰</p>
<p>ç„¶åä½ æ³¨æ„åˆ°ï¼Œæ”¯ä»˜é¡µé¢å®Œå…¨å”¯ä¸€çš„ä»£ç ä¸º 7 KBã€‚ è¯¥ç½‘ç«™çš„å…¶ä½™éƒ¨åˆ†ä¸º 300 KBã€‚ æˆ‘çœ‹åˆ°è¿™ä¸ªä¼šè¯´ï¼Œemmï¼Œæˆ‘ä¸ä¼šè´¹åŠ›å»æ‹†åˆ†è¿™å—çš„ä»£ç ï¼Œæœ‰è¿™ä¹ˆå‡ ä¸ªåŸå› ï¼š</p>
<ul>
<li>
<p>é¢„å…ˆåŠ è½½å®ƒä¸ä¼šå‡æ…¢é€Ÿåº¦ã€‚ è®°ä½ä½ æ­£åœ¨å¹¶è¡ŒåŠ è½½æ‰€æœ‰è¿™äº›æ–‡ä»¶ã€‚ å¯ä»¥è¯•è¯•çœ‹è®°å½• 300 KB å’Œ 307 KBä¹‹é—´çš„åŠ è½½æ—¶é—´å·®å¼‚ã€‚</p>
</li>
<li>
<p>å¦‚æœä½ æƒ³ä¹‹ååŠ è½½è¿™å—çš„ä»£ç ï¼Œé‚£ç”¨æˆ·åœ¨ç‚¹å‡»ã€ŒæŠŠæˆ‘çš„é’±æ‹¿èµ°ã€çš„æ—¶å€™å¿…é¡»ç­‰å¾…è¿™å—çš„æ–‡ä»¶â€”â€”è¿™ä¸ªæ—¶å€™æ­£æ˜¯ä½ æƒ³è¦å®ƒæœ€å¹³æ»‘çš„æ—¶å€™ã€‚</p>
</li>
<li>
<p>Code splitting è¦æ±‚ä½ æ”¹ä½ çš„é¡¹ç›®ä¸­çš„ä»£ç ã€‚ å®ƒå¼•å…¥äº†å¼‚æ­¥é€»è¾‘ï¼Œè€Œä»¥å‰åªæœ‰åŒæ­¥é€»è¾‘ã€‚ è¿™ä¸æ˜¯ä»€ä¹ˆé€ ç«ç®­çš„å­¦é—®ï¼Œä½†æ˜¯ä¹Ÿå…·æœ‰å¤æ‚æ€§ï¼Œå› æ­¤æˆ‘è®¤ä¸ºåº”è¯¥ä»¥å¯æ„Ÿè§‰åˆ°çš„ç”¨æˆ·ä½“éªŒæ”¹å–„ä¸ºç”±ï¼ˆå»åšè¿™ä»¶äº‹ï¼‰ã€‚</p>
</li>
</ul>
<p>OKï¼Œä»¥ä¸Šå°±æ˜¯æ‰€æœ‰çš„ç±»ä¼¼äºã€Œè¿™é¡¹ä»¤äººå…´å¥‹çš„æŠ€æœ¯å¯èƒ½ä¸é€‚ç”¨ä½ ã€çš„æ´¾å¯¹æ‰«å…´è€…çš„è¯æœ¯äº†ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸¤ä¸ª code-splitting çš„ä¾‹å­â€¦â€¦</p>
<h2 id="polyfills">Polyfills</h2>
<p>æˆ‘å°†ä»è¿™é‡Œå¼€å§‹ï¼Œå› ä¸ºå®ƒé€‚ç”¨äºå¤§å¤šæ•°ç½‘ç«™ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç®€å•å…¥é—¨ã€‚</p>
<p>æˆ‘åœ¨ç½‘ç«™ä¸Šä½¿ç”¨äº†è®¸å¤šèŠ±å“¨çš„åŠŸèƒ½ï¼Œå› æ­¤æˆ‘æœ‰å¯ä»¥å¯¼å…¥æˆ‘éœ€è¦çš„æ‰€æœ‰polyfillsçš„æ–‡ä»¶ã€‚ å®ƒåŒ…æ‹¬ä»¥ä¸‹å…«è¡Œï¼š</p>
<pre><code class="language-javascript">require('whatwg-fetch');
require('intl');
require('url-polyfill');
require('core-js/web/dom-collections');
require('core-js/es6/map');
require('core-js/es6/string');
require('core-js/es6/array');
require('core-js/es6/object');
</code></pre>
<p>æˆ‘ç›´æ¥åœ¨å…¥å£ <code>index.js</code> çš„é¡¶éƒ¨å¯¼å…¥æ­¤æ–‡ä»¶ã€‚</p>
<pre><code class="language-javascript">import './polyfills';
import React from 'react';
import ReactDOM from 'react-dom';
import App from './App/App';
import './index.css';

const render = () =&gt; {
  ReactDOM.render(&lt;App /&gt;, document.getElementById('root'));
}

render(); // å¯¹ï¼Œç›®å‰è¿™ä¸€è¡Œæ˜¯æ— æ„ä¹‰çš„
</code></pre>
<p>æˆ‘ä»¬ä½¿ç”¨ bundle spiltting éƒ¨åˆ†ä¸­çš„ Webpack configï¼Œç”±äºè¿™é‡Œæœ‰å››ä¸ª npm åŒ…ï¼Œæˆ‘çš„ polyfill å°†è¢«è‡ªåŠ¨æ‹†åˆ†ä¸ºå››ä¸ªä¸åŒçš„æ–‡ä»¶ã€‚ å®ƒä»¬æ€»å…±çº¦ 25 KBï¼Œå¹¶ä¸”90ï¼…çš„æµè§ˆå™¨ä¸éœ€è¦å®ƒä»¬ï¼Œæ‰€ä»¥å€¼å¾—åŠ¨æ€åŠ è½½ã€‚</p>
<p>ä½¿ç”¨ Webpack 4å’Œ <code>import()</code> è¯­æ³•ï¼ˆä¸è¦å’Œæ²¡æœ‰æ‹¬å·çš„<code>import</code>è¯­æ³•ææ··äº†ï¼‰ï¼Œæ¡ä»¶åŠ è½½polyfillæ˜¯éå¸¸å®¹æ˜“çš„ã€‚</p>
<pre><code class="language-javascript">import React from 'react';
import ReactDOM from 'react-dom';
import App from './App/App';
import './index.css';

const render = () =&gt; {
  ReactDOM.render(&lt;App /&gt;, document.getElementById('root'));
}

if (
  'fetch' in window &amp;&amp;
  'Intl' in window &amp;&amp;
  'URL' in window &amp;&amp;
  'Map' in window &amp;&amp;
  'forEach' in NodeList.prototype &amp;&amp;
  'startsWith' in String.prototype &amp;&amp;
  'endsWith' in String.prototype &amp;&amp;
  'includes' in String.prototype &amp;&amp;
  'includes' in Array.prototype &amp;&amp;
  'assign' in Object &amp;&amp;
  'entries' in Object &amp;&amp;
  'keys' in Object
) {
  render();
} else {
  import('./polyfills').then(render);
}
</code></pre>
<p>æœ‰é“ç†å§ï¼Ÿ å¦‚æœæ‰€æœ‰è¿™äº›ä¸œè¥¿éƒ½æ”¯æŒçš„è¯ï¼Œå°±æ¸²æŸ“é¡µé¢ã€‚ å¦åˆ™å¯¼å…¥polyfillsï¼Œç„¶åæ¸²æŸ“é¡µé¢ã€‚ å½“æ­¤ä»£ç åœ¨æµè§ˆå™¨ä¸­è¿è¡Œæ—¶ï¼ŒWebpack è¿è¡Œæ—¶å°†å¤„ç†è¿™å››ä¸ª npm åŒ…çš„åŠ è½½ï¼Œå¹¶ä¸”åœ¨ä¸‹è½½å¹¶è§£æå®ƒä»¬åï¼Œè°ƒç”¨<code>render()</code> å¹¶ç»§ç»­è¿›è¡Œã€‚</p>
<p>ï¼ˆé¡ºä¾¿è¯´ä¸€å¥ï¼Œè¦ä½¿ç”¨<code>import()</code>ï¼Œä½ å°†éœ€è¦<a href="https://babeljs.io/docs/en/babel-plugin-syntax-dynamic-import/">Babelçš„dynamic-import plugin</a>ã€‚æ­¤å¤–ï¼Œæ­£å¦‚Webpackæ–‡æ¡£æ‰€è¯´ï¼Œ<code>import()</code><a href="https://webpack.js.org/guides/code-splitting/#dynamic-imports">ç”¨äº†promises</a>ï¼Œä½ éœ€è¦å°†è¿™ä¸ªpolyfillä¸å…¶ä»–polyfillåˆ†å¼€å»polyfillã€‚ï¼‰</p>
<p>å¾ˆç®€å•ï¼Œæ˜¯å§ï¼Ÿ</p>
<p>ä¸‹é¢æ˜¯æœ‰äº›éº»çƒ¦çš„ä¾‹å­â€¦â€¦</p>
<h2 id="åŸºäºè·¯ç”±çš„åŠ¨æ€åŠ è½½react-ç‹¬å ">åŸºäºè·¯ç”±çš„åŠ¨æ€åŠ è½½ï¼ˆReact ç‹¬å ï¼‰</h2>
<p>å›åˆ° Alice çš„ä¾‹å­ï¼Œå‡è®¾è¯¥ç½‘ç«™ç°åœ¨æœ‰ä¸€ä¸ªã€Œç®¡ç†ã€éƒ¨åˆ†ï¼Œå•†å“é”€å”®è€…å¯ä»¥ç™»å½•å¹¶ç®¡ç†ä»–ä»¬æƒ³è¦å‡ºå”®çš„ç©æ„ã€‚</p>
<p>è¿™ä¸€å—å…·æœ‰è®¸å¤šå®Œç¾çš„ç‰¹æ€§ï¼Œå¤§é‡çš„å›¾è¡¨ä»¥åŠ npm ä¸­çš„å¤§å‹å›¾æ ‡åº“ã€‚ æˆ‘å·²ç»åšäº† bundle splittingï¼Œå¯ä»¥çœ‹åˆ°å®ƒä»¬å…¨éƒ¨è¶…è¿‡100 KBã€‚</p>
<p>å½“å‰ï¼Œæˆ‘æœ‰ä¸€ä¸ªè·¯ç”±è®¾ç½®ï¼Œå½“ç”¨æˆ·æŸ¥çœ‹/admin URLæ—¶å°†å‘ˆç°<code>&lt;AdminPage&gt;</code>ã€‚ å½“Webpackå°†æ‰€æœ‰å†…å®¹æ‰“åŒ…åœ¨ä¸€èµ·æ—¶ï¼Œå®ƒå°†æ‰¾åˆ°<code>import AdminPage from './AdminPage.js'</code>ï¼Œç„¶åè¯´â€œå–‚ï¼Œæˆ‘éœ€è¦åœ¨åˆå§‹æœ‰æ•ˆè½½è·ä¸­åŒ…æ‹¬å®ƒâ€ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›è¿™æ ·ã€‚ æˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªå¼•ç”¨æ”¾åœ¨ admin é¡µé¢åŠ¨æ€å¯¼å…¥é‡Œï¼Œæ¯”å¦‚<code>import('./AdminPage.js')</code>ï¼ŒWebpack å°±ä¼šçŸ¥é“éœ€è¦åŠ¨æ€åŠ è½½å®ƒã€‚</p>
<p>å¾ˆé…·ï¼Œä¸éœ€è¦ä»»ä½•é…ç½®ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä¸ä¸åº”è¯¥ç›´æ¥å¼•ç”¨<code>AdminPage</code>ï¼Œè€Œæ˜¯å»ºå¦ä¸€ä¸ªå°†åœ¨ç”¨æˆ·è®¿é—®<code>/admin</code> URLæ—¶å‘ˆç°çš„ç»„ä»¶ï¼Œ å®ƒå¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<pre><code class="language-javascript">
import React from 'react';

class AdminPageLoader extends React.PureComponent {
  constructor(props) {
    super(props);

    this.state = {
      AdminPage: null,
    }
  }

  componentDidMount() {
    import('./AdminPage').then(module =&gt; {
      this.setState({ AdminPage: module.default });
    });
  }

  render() {
    const { AdminPage } = this.state;

    return AdminPage
      ? &lt;AdminPage {...this.props} /&gt;
      : &lt;div&gt;Loading...&lt;/div&gt;;
  }
}

export default AdminPageLoader;
</code></pre>
<p>è¿™ä¸ªæ¦‚å¿µå¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿ ç»„ä»¶<code>mount</code>åï¼ˆæ„å‘³ç€ç”¨æˆ·ä½äº<code>/admin</code> URLï¼‰ï¼Œæˆ‘ä»¬å°†åŠ¨æ€åŠ è½½<code>./AdminPage.js</code>ï¼Œç„¶åä¿å­˜è¯¥ç»„ä»¶çš„å¼•ç”¨ã€‚</p>
<p>åœ¨ render æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä»…ä»…ç®€å•åœ°åœ¨ç­‰å¾…<code>&lt;AdminPage&gt;</code>åŠ è½½æ—¶æ¸²æŸ“<code>&lt;div&gt; Loading ... &lt;/ div&gt;</code>ï¼Œåœ¨<code>&lt;AdminPage&gt;</code>åŠ è½½å®Œæˆå­˜å‚¨å®ƒã€‚</p>
<p>æˆ‘åªæ˜¯å‡ºäºå¥½ç©å†™äº†è¿™ä¸ªä¾‹å­ï¼Œå®é™…ä¸Šä½ åªéœ€è¦ä½¿ç”¨<code>react-loadable</code>æ¥å®ç°å®ƒï¼Œæ­£å¦‚ <a href="https://reactjs.org/docs/code-splitting.html">React Code-Splitting</a> æ–‡æ¡£è¯´çš„é‚£æ ·ã€‚</p>
<hr />
<p>å¥½å•¦ï¼Œæˆ‘æƒ³è¿™å°±æ˜¯å…¨éƒ¨äº†ã€‚æœ‰æ²¡æœ‰å¯ä»¥æ€»ç»“æˆ‘ä¸Šé¢è¯´è¿‡çš„ä¸œè¥¿çš„å¥å­ï¼Œä½†ç”¨æ›´å°‘çš„æ–‡å­—ï¼Ÿ</p>
<ul>
<li>
<p>å¦‚æœäººä»¬å¤šæ¬¡è®¿é—®ä½ çš„ç½‘ç«™ï¼Œå°±æŠŠä½ çš„çš„ä»£ç åˆ†æˆè®¸å¤šå°æ–‡ä»¶ã€‚</p>
</li>
<li>
<p>å¦‚æœä½ çš„ç½‘ç«™ä¸Šæœ‰å¤§éƒ¨åˆ†ç”¨æˆ·ä¸è®¿é—®çš„å¤§å—å†…å®¹ï¼ŒåŠ¨æ€åŠ è½½è¿™å—ä»£ç ã€‚</p>
</li>
</ul>
<p>æ„Ÿè°¢é˜…è¯»ã€‚ç¥ä½ ä»Šå¤©æ„‰å¿«~</p>
<p>é ï¼Œæˆ‘å¿˜äº†æ CSS äº†ã€‚</p>
<hr />
<mark style="font-weight: bold; font-size: 25px">æœ¬æ–‡ç”±æœ¬åšå®¢åšä¸» Moltemort ç¿»è¯‘ï¼Œè½¬è½½æœ¬æ–‡è¯·æ³¨æ˜æºé“¾æ¥</mark>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Back2Blog]]></title>
        <id>https://CallanBi.github.io/post/back2blog/</id>
        <link href="https://CallanBi.github.io/post/back2blog/">
        </link>
        <updated>2021-05-03T14:42:16.000Z</updated>
        <content type="html"><![CDATA[<p>æœ¬ç§‘æ—¶è‡ªå·±ä¹°é˜¿é‡Œäº‘æœåŠ¡å™¨æ­çš„åšå®¢ï¼Œå› ä¸ºæœåŠ¡å™¨è¿‡æœŸï¼Œæ•°æ®æ²¡å¤‡ä»½æ—©å·²æ¶ˆå¤±åœ¨é£ä¸­ï¼Œåªå‰©ä¸‹åŸŸåè¿˜åœ¨äº†ğŸ¤·â€â™‚<br>
å·¥ä½œ10ä¸ªæœˆä¸šåŠ¡ååˆ†ç¹å¿™ï¼Œå›é¦–æ¥çœ‹æ€»æ„Ÿè§‰ç§¯ç´¯çš„æˆé•¿æ²¡å¾—åˆ°è®°å½•ã€‚</p>
<p>æ‰€ä»¥æˆ‘å†³å®šé‡æ–°Back2Blogï¼Œå°±ä»è¿™ä¸ªäº”ä¸€å‡æœŸï¼Œä»ä»Šå¤©å¼€å§‹å§~</p>
]]></content>
    </entry>
</feed>